<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<title>FormFlow | Bot Builder SDK C# Reference Library | Bot Framework</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
    <!--
<link href="/js/doxygen/navtree.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="/js/doxygen/resize.js"></script>
<script type="text/javascript" src="/js/doxygen/navtreedata.js"></script>
<script type="text/javascript" src="/js/doxygen/navtree.js"></script>
        -->
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="botframework.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="/css/documentation.css">
    <script type="text/javascript">
        $(document).ready(function () {
            var sidenav = $('#side-nav');
            sidenav.before('<div id="content-container" class="outline"></div>');
            var doccontent = $('#doc-content');
			var contentcontainer = $('#content-container');
            contentcontainer.append(sidenav);
            contentcontainer.append(doccontent);
            doccontent.prepend($('#referenceSearch'));
			var top = $('#top');
			top.before('<div class="fullWidth"></div>');
			var fullwidth = $('div.fullWidth');
			fullwidth.before('<div id="app-body"></div>');
			fullwidth.append(top);
			fullwidth.append(contentcontainer);
			fullwidth.append($('.footer'));
			var appbody = $('#app-body');
			appbody.append(fullwidth);
			$('#MSearchField').removeAttr('value').attr('placeholder', 'Search the Bot Builder SDK C# reference');
        });
    </script>
</head>
<body>
<div id="referenceSearch"></div>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div>
		<header>
			<div class="outline">
				<div class="header">
					<a class="logo" href="//www.microsoft.com">
						<svg class="svgicon svgicon-microsoft-color-logo">
							<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/symbol-defs.svg#svgicon-microsoft-color-logo"></use>
						</svg>
					</a>
					<div class="loading-animation"></div>
					<span class="environment"></span>
					<div>
					</div>
				</div>
			</div>
		</header>
		<div class="brand-primary">
			<div class="jumbo">
				<div class="jumbo-header"><a href="https://www.botframework.com/">Bot Framework</a></div>
					<ul class="header-nav"><li><a href="https://dev.botframework.com/#/bots">My bots</a>
						</li><li>
						<a href="https://dev.botframework.com/#/bots/new">Register a bot</a></li><li class="active">
						<a href="/">Documentation</a></li><li>
						<a href="https://bots.botframework.com/" class="active">Bot Directory</a></li></ul>
				</div>
			</div>
		</div>
	</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('forms.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">FormFlow </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#fields">Forms and Fields</a></li>
<li class="level1"><a href="#simpleSandwichBot">Simple Sandwich Bot</a></li>
<li class="level1"><a href="#annotatedSandwich">Annotated Sandwich Bot</a><ul><li class="level2"><a href="#attributes">Attributes</a></li>
<li class="level2"><a href="#logic">Adding Business Logic</a></li>
<li class="level2"><a href="#ControlFlow">Using the Form Builder</a></li>
</ul>
</li>
<li class="level1"><a href="#initialState">Passing in Initial Form State and Entities</a></li>
<li class="level1"><a href="#patterns">Pattern Language</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p><a class="el" href="dialogs.html">Dialogs</a> are very powerful and flexible, but handling a guided conversation like ordering a sandwich can require a lot of effort. At each point in the dialog, there are many possibilities for what happens next. You may need to clarify an ambiguity, provide help, go back or show progress so far. In order to simplify building guided conversations the framework provides a powerful dialog building block known as FormFlow. FormFlow sacrifices some of the flexibility provided by dialogs, but in a way that requires much less effort. Even better, you can combine FormFlow generate dialogs and other kinds of dialogs like a <a class="el" href="d8/df9/class_microsoft_1_1_bot_1_1_builder_1_1_dialogs_1_1_luis_dialog.html">LuisDialog</a> to get the best of both worlds. A FormFlow dialog guides the user through filling in the form while provding help and guidance along the way.</p>
<p>The clearest way to understand this is to take a look at the <a class="el" href="forms.html#simpleSandwichBot">Simple Sandwich Bot</a> sample. In that sample you define the form you want using C# classes, fields and properties. That is all you need to do to get a pretty good dialog that supports help, clarification, status and navigation without any more effort. Once you have that dialog you can make use of simple annotations to improve your bot in a straightforward way.</p>
<h1><a class="anchor" id="fields"></a>
Forms and Fields</h1>
<p>FormFlow starts with the idea of a form&ndash;a collection of fields that you want to fill in through a conversation with the user. The simplest way to describe a form is through a C# class. Within a class, a "field" is any public field or property with one of the following types:</p><ul>
<li>Integral &ndash; sbyte, byte, short, ushort, int, uint, long, ulong</li>
<li>Floating point &ndash; float, double</li>
<li>String</li>
<li>DateTime</li>
<li>Enum</li>
<li>List of enum</li>
</ul>
<p>Any of the data types can also be nullable which is a good way to model that the field does not have a value. If a field is based on an enum and it is not nullable, then the 0 value in the enum is considered to be null and you should start your enumeration at 1. Any other fields, properties or methods are ignored by the FormFlow code. It is also possible to define a form directly by implementing <a class="el" href="d5/d09/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_i_field.html" title="Interface for all the information about a specific field. ">Advanced.IField</a> or using <a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html" title="Base class with declarative implementation of IField&lt;T&gt;. ">Advanced.Field</a> and populating the dictionaries within it. In order to better understand Form Flow and its capabilities we will work through two examples, <a class="el" href="forms.html#simpleSandwichBot">Simple Sandwich Bot</a> where everything is automatically generated and <a class="el" href="forms.html#annotatedSandwich">Annotated Sandwich Bot</a> where the form is extensively customized.</p>
<h1><a class="anchor" id="simpleSandwichBot"></a>
Simple Sandwich Bot</h1>
<p>As an example of FormFlow in action, we will outline a simple sandwich ordering form that will be elaborated in <a class="el" href="forms.html#annotatedSandwich">Annotated Sandwich Bot</a> to show various features. To start with FormFlow you need to create a C# class to define the form you want to fill in. Like this: </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html">FormFlow</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><span class="preprocessor">#pragma warning disable 649</span></div><div class="line"></div><div class="line"><span class="comment">// The SandwichOrder is the simple form you want to fill out.  It must be serializable so the bot can be stateless.</span></div><div class="line"><span class="comment">// The order of fields defines the default order in which questions will be asked.</span></div><div class="line"><span class="comment">// Enumerations shows the legal options for each field in the SandwichOrder and the order is the order values will be presented </span></div><div class="line"><span class="comment">// in a conversation.</span></div><div class="line"><span class="keyword">namespace </span><a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.Bot.Sample.SimpleSandwichBot</div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SandwichOptions</div><div class="line">    {</div><div class="line">        BLT, BlackForestHam, BuffaloChicken, ChickenAndBaconRanchMelt, ColdCutCombo, MeatballMarinara,</div><div class="line">        OverRoastedChicken, RoastBeef, RotisserieStyleChicken, SpicyItalian, SteakAndCheese, SweetOnionTeriyaki, Tuna,</div><div class="line">        TurkeyBreast, Veggie</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> LengthOptions { SixInch, FootLong };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> BreadOptions { NineGrainWheat, NineGrainHoneyOat, Italian, ItalianHerbsAndCheese, Flatbread };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> CheeseOptions { American, MontereyCheddar, Pepperjack };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ToppingOptions</div><div class="line">    {</div><div class="line">        Avocado, BananaPeppers, Cucumbers, GreenBellPeppers, Jalapenos,</div><div class="line">        Lettuce, Olives, Pickles, RedOnion, Spinach, Tomatoes</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SauceOptions</div><div class="line">    {</div><div class="line">        ChipotleSouthwest, HoneyMustard, LightMayonnaise, RegularMayonnaise,</div><div class="line">        Mustard, Oil, Pepper, Ranch, SweetOnion, Vinegar</div><div class="line">    };</div><div class="line"></div><div class="line">    [Serializable]</div><div class="line">    <span class="keyword">class </span>SandwichOrder</div><div class="line">    {</div><div class="line">        <span class="keyword">public</span> SandwichOptions? Sandwich;</div><div class="line">        <span class="keyword">public</span> LengthOptions? Length;</div><div class="line">        <span class="keyword">public</span> BreadOptions? Bread;</div><div class="line">        <span class="keyword">public</span> CheeseOptions? Cheese;</div><div class="line">        <span class="keyword">public</span> List&lt;ToppingOptions&gt; Toppings;</div><div class="line">        <span class="keyword">public</span> List&lt;SauceOptions&gt; Sauce;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildForm()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                    .Message(<span class="stringliteral">&quot;Welcome to the simple sandwich order bot!&quot;</span>)</div><div class="line">                    .Build();</div><div class="line">        }</div><div class="line">    };</div><div class="line">}</div></div><!-- fragment --><p> Included in the class is a static method BuildForm that uses a <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html">FormBuilder</a> to build your form. There are lots of things you can do with the form builder, but we will cover that later and here we just define a simple welcome message.</p>
<p>In order to connect your form to the bot framework you need to add it to your controller like this:  <div class="fragment"><div class="line">        <span class="keyword">internal</span> <span class="keyword">static</span> IFormDialog&lt;SandwichOrder&gt; MakeRootDialog()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> FormDialog.FromForm(SandwichOrder.BuildForm);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">public</span> async Task&lt;Message&gt; Post([FromBody]Message message)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (message.Type == <span class="stringliteral">&quot;Message&quot;</span>)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">return</span> await Conversation.SendAsync(message, MakeRootDialog);</div><div class="line">            }</div></div><!-- fragment --></p>
<p>The combination of your C# class and connecting it to the Bot Framework is enough to automatically create a conversation. Here is an example interaction that demonstrates some of the features offered by FormFlow. A <b>&gt;</b> symbol shows where a response is expected from the user and any input that was entered at that point in the dialog. </p><div class="fragment"><div class="line">Please select a sandwich</div><div class="line">1. BLT</div><div class="line">2. Black Forest Ham</div><div class="line">3. Buffalo Chicken</div><div class="line">4. Chicken And Bacon Ranch Melt</div><div class="line">5. Cold Cut Combo</div><div class="line">6. Meatball Marinara</div><div class="line">7. Over Roasted Chicken</div><div class="line">8. Roast Beef</div><div class="line">9. Rotisserie Style Chicken</div><div class="line">10. Spicy Italian</div><div class="line">11. Steak And Cheese</div><div class="line">12. Sweet Onion Teriyaki</div><div class="line">13. Tuna</div><div class="line">14. Turkey Breast</div><div class="line">15. Veggie</div><div class="line">&gt;</div></div><!-- fragment --><p>Here you can see the field SandwichOrder.Sandwich being filled in. First off you can see the automatically generated prompt "Please select a sandwich". The word "sandwich" came from the name of the field. The SandwichOptions enumeration provided the choices that make up the list. Each enumeration was broken into words based on changes in case and underscores.</p>
<p>Now what are the possible responses? If you ask for "help" you can see this: </p><div class="fragment"><div class="line">&gt; help</div><div class="line">* You are filling in the sandwich field.Possible responses:</div><div class="line">* You can enter a number 1-15 or words from the descriptions. (BLT, Black Forest Ham, Buffalo Chicken, Chicken And Bacon Ranch Melt, Cold Cut Combo, Meatball Marinara, Over Roasted Chicken, Roast Beef, Rotisserie Style Chicken, Spicy Italian, Steak And Cheese, Sweet Onion Teriyaki, Tuna, Turkey Breast, and Veggie)</div><div class="line">* Back: Go back to the previous question.</div><div class="line">* Help: Show the kinds of responses you can enter.</div><div class="line">* Quit: Quit the form without completing it.</div><div class="line">* Reset: Start over filling in the form. (With defaults of your previous entries.)</div><div class="line">* <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ab2b85bccad5c568fc9db82cac5ab6354aec53a8c4f07baed5d8825072c89799be">Status</a>: Show your progress in filling in the form so far.</div><div class="line">* You can <span class="keywordflow">switch</span> to another field by entering its name. (Sandwich, Length, Bread, Cheese, Toppings, and Sauce).</div></div><!-- fragment --><p>As described in th help, you can respond to this prompt by responding with the number of the choice you want, or you can also use the words that are found in the choice descriptions. There are also a number of commands that let you back up a step, get help, quit, start over or get the progress so far. Let's enter "2" to select "Black Forest Ham". </p><div class="fragment"><div class="line"> Please select a sandwich</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Over Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; 2</div><div class="line">Please select a length(1. Six Inch, 2. Foot Long)</div><div class="line">&gt; </div></div><!-- fragment --><p>Now we get the next prompt which is for the SandwichOrder.Length property. If you wanted to back up to check on your change, you could type 'back' like this: </p><div class="fragment"><div class="line">&gt; back</div><div class="line">Please select a sandwich(current choice: Black Forest Ham)</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Over Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div></div><!-- fragment --><p>Now we can see that we selected "Black Forest Ham" and we can continue by typing "c" to keep the current choice and "1" to select a six inch sandwich. </p><div class="fragment"><div class="line">Please select a sandwich (current choice: Black Forest Ham)</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Over Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; c</div><div class="line">Please select a length(1. Six Inch, 2. Foot Long)</div><div class="line">&gt; 1</div></div><!-- fragment --><p>In addition to typing numbers and commands you can also type in words from the choices. Here we have typed "nine grain" which is ambiguous and the Form Flow system automatically asks for clarification. </p><div class="fragment"><div class="line">Please select a bread</div><div class="line"> 1. Nine Grain Wheat</div><div class="line"> 2. Nine Grain Honey Oat</div><div class="line"> 3. Italian</div><div class="line"> 4. Italian Herbs And Cheese</div><div class="line"> 5. Flatbread</div><div class="line">&gt; nine grain</div><div class="line">By <span class="stringliteral">&quot;nine grain&quot;</span> bread did you mean(1. Nine Grain Honey Oat, 2. Nine Grain Wheat)</div><div class="line">&gt; 1</div></div><!-- fragment --><p>What happens if you type in something which is not understood or a mixture of understood and not understood words? In the below you can see both something that is not understood at all and also a mixture of understood and not understood things. </p><div class="fragment"><div class="line">Please select a cheese (1. American, 2. Monterey Cheddar, 3. Pepperjack)</div><div class="line">&gt; amercan</div><div class="line"><span class="stringliteral">&quot;amercan&quot;</span> is not a cheese option.</div><div class="line">&gt; american smoked</div><div class="line">For cheese I understood American. <span class="stringliteral">&quot;smoked&quot;</span> is not an option.</div></div><!-- fragment --><p>Some fields like SandiwchOrder.Toppings allow multiple choices. Here we are entering multiple choices and showing another example of clarification. </p><div class="fragment"><div class="line">Please select one or more toppings</div><div class="line"> 1. Banana Peppers</div><div class="line"> 2. Cucumbers</div><div class="line"> 3. Green Bell Peppers</div><div class="line"> 4. Jalapenos</div><div class="line"> 5. Lettuce</div><div class="line"> 6. Olives</div><div class="line"> 7. Pickles</div><div class="line"> 8. Red Onion</div><div class="line"> 9. Spinach</div><div class="line"> 10. Tomatoes</div><div class="line">&gt; peppers, lettuce and tomatoe</div><div class="line">By <span class="stringliteral">&quot;peppers&quot;</span> toppings did you mean(1. Green Bell Peppers, 2. Banana Peppers)</div><div class="line">&gt; 1</div></div><!-- fragment --><p>At this point, I might wonder how much is left and I can ask about my progress so far by typing "status". When I do so, I see my form and all that is left to fill out is my SandwichOrder.Sauce. </p><div class="fragment"><div class="line">Please select one or more sauce</div><div class="line"> 1. Honey Mustard</div><div class="line"> 2. Light Mayonnaise</div><div class="line"> 3. Regular Mayonnaise</div><div class="line"> 4. Mustard</div><div class="line"> 5. Oil</div><div class="line"> 6. Pepper</div><div class="line"> 7. Ranch</div><div class="line"> 8. Sweet Onion</div><div class="line"> 9. Vinegar</div><div class="line">&gt; status</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Six Inch</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313a6fcdc090caeade09d0efd6253932b6f5">Unspecified</a>  </div></div><!-- fragment --><p>I select "1" for "Honey Mustard" and I've reached the end and I'm asked to confirm my order. </p><div class="fragment"><div class="line">Please select one or more sauce</div><div class="line"> 1. Honey Mustard</div><div class="line"> 2. Light Mayonnaise</div><div class="line"> 3. Regular Mayonnaise</div><div class="line"> 4. Mustard</div><div class="line"> 5. Oil</div><div class="line"> 6. Pepper</div><div class="line"> 7. Ranch</div><div class="line"> 8. Sweet Onion</div><div class="line"> 9. Vinegar</div><div class="line">&gt; 1</div><div class="line">Is ths your selection?</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Six Inch</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: Honey Mustard</div><div class="line">&gt;</div></div><!-- fragment --><p>If I say "no", then I get the option to change any part of the form. In this case I change the length and then say "y" which then returns the completed form to the caller. </p><div class="fragment"><div class="line">Is ths your selection?</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Six Inch</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: Honey Mustard</div><div class="line">&gt; no</div><div class="line">What <span class="keywordflow">do</span> you want to change?</div><div class="line"> 1. Sandwich(Black Forest Ham)</div><div class="line"> 2. Length(Six Inch)</div><div class="line"> 3. Bread(Nine Grain Honey Oat)</div><div class="line"> 4. Cheese(American)</div><div class="line"> 5. Toppings(Lettuce, Tomatoes, and Green Bell Peppers)</div><div class="line"> 6. Sauce(Honey Mustard)</div><div class="line">&gt; 2</div><div class="line">Please select a length(current choice: Six Inch) (1. Six Inch, 2. Foot Long)</div><div class="line">&gt; 2</div><div class="line">Is ths your selection?</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Foot Long</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: Honey Mustard</div><div class="line"></div><div class="line">&gt; y</div></div><!-- fragment --><p> At this point, the form is completed and will be returned to the parent dialog. Throughout this interaction you can see that the automatically generated conversation:</p><ul>
<li>Provided clear guidance and help</li>
<li>Understands both numbers and textual entries</li>
<li>Gives feedback on what is understood and what is not.</li>
<li>Asks clarifying questions when needed.</li>
<li>Allows navigating between the steps.</li>
</ul>
<p>All of this is pretty amazing for not having to do any of the work! However, not every interaction was as good as you might want it to be. That is why there are easy ways to provide:</p><ul>
<li>Messages during the process of filling in a form.</li>
<li>Custom prompts per field.</li>
<li>Templates to use when automatically generating prompts or help.</li>
<li>Terms to match on.</li>
<li>Whether to show choices and numbers or not.</li>
<li>Fields that are optional.</li>
<li>Conditional fields.</li>
<li>Value validation</li>
<li>and much more...</li>
</ul>
<p>The next example shows how to improve the sandwich bot with attributes, business logic and the <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html">FormBuilder</a>.</p>
<h1><a class="anchor" id="annotatedSandwich"></a>
Annotated Sandwich Bot</h1>
<p>This example builds on the previous one by:</p><ul>
<li>Adding some new field types including string and DateTime.</li>
<li>Adding attributes to add descriptions, terms, prompts and templates.</li>
<li>Switching from fields to properties to incorporate business logic.</li>
<li>Adding messages, flow control and confirmations.</li>
</ul>
<h2><a class="anchor" id="attributes"></a>
Attributes</h2>
<p>FormFlow includes some C# attributes you can add to your class to better control the dialog. Here are the attributes:</p>
<table class="doxtable">
<tr>
<th>Attribute </th><th>Purpose  </th></tr>
<tr>
<td><a class="el" href="dd/d38/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_describe_attribute.html">Describe</a> </td><td>Change how a field or a value is shown in text. </td></tr>
<tr>
<td><a class="el" href="df/d31/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_numeric_attribute.html">Numeric</a> </td><td>Provide limits on the values accepted in a numeric field. </td></tr>
<tr>
<td><a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a></td><td>Mark a field as optional which means that one choice is not to supply a value. </td></tr>
<tr>
<td><a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a></td><td>Define a prompt to use when asking for a field. </td></tr>
<tr>
<td><a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> </td><td>Define a template that is used to generate prompts or values in prompts. </td></tr>
<tr>
<td><a class="el" href="d2/d27/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_terms_attribute.html">Terms</a> </td><td>Define the input terms that match a field or value. </td></tr>
</table>
<p>Let's look at how these attributes can improve your bot. First off, we might want to change the the prompt for SandwichOrder.Sandwich from the automatically generated "Please select a sandwich" to "What kind of sandwich would you like?". To do this we would use the <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> attribute like this:  <div class="fragment"><div class="line">        [Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like? {||}&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> SandwichOptions? Sandwich;</div></div><!-- fragment --></p>
<p>One thing you will notice is the the prompt contains the funny strings "{&amp;}" and "{||}". That is because prompt and message strings are written in <a class="el" href="forms.html#patterns">Pattern Language</a> where you can have parts of the string that are filled in when the actual prompt or message is generated. In this case "{&amp;}" means fill in the description of the field and "{||}" means show the choices that are possible. The description of a field is automatically generated from the field name, but you could also use a Describe attribute to override that. By adding this attribute, the prompt for SandwichOrder.Sandwich now looks like: </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line">1. BLT</div><div class="line">2. Black Forest Ham</div><div class="line">3. Buffalo Chicken</div><div class="line">4. Chicken And Bacon Ranch Melt</div><div class="line">5. Cold Cut Combo</div><div class="line">6. Meatball Marinara</div><div class="line">7. Over Roasted Chicken</div><div class="line">8. Roast Beef</div><div class="line">9. Rotisserie Style Chicken</div><div class="line">10. Spicy Italian</div><div class="line">11. Steak And Cheese</div><div class="line">12. Sweet Onion Teriyaki</div><div class="line">13. Tuna</div><div class="line">14. Turkey Breast</div><div class="line">15. Veggie</div><div class="line">&gt;</div></div><!-- fragment --><p>There are lots of things you can control when specifiying a prompt. For example with this prompt attribute: </p><div class="fragment"><div class="line">[Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like? {||}&quot;</span>, ChoiceFormat=<span class="stringliteral">&quot;{1}&quot;</span>)]</div></div><!-- fragment --><p> The prompt would now no longer show numbers and the only accepted input would be words from the choices. </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line">* BLT</div><div class="line">* Black Forest Ham</div><div class="line">* Buffalo Chicken</div><div class="line">* Chicken And Bacon Ranch Melt</div><div class="line">* Cold Cut Combo</div><div class="line">* Meatball Marinara</div><div class="line">* Over Roasted Chicken</div><div class="line">* Roast Beef</div><div class="line">* Rotisserie Style Chicken</div><div class="line">* Spicy Italian</div><div class="line">* Steak And Cheese</div><div class="line">* Sweet Onion Teriyaki</div><div class="line">* Tuna</div><div class="line">* Turkey Breast</div><div class="line">* Veggie</div><div class="line">&gt;</div></div><!-- fragment --><p>Going a step further, you could decide not to show the choices at all like this: </p><div class="fragment"><div class="line">[Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like?&quot;</span>)]</div></div><!-- fragment --><p> The prompt then would not show the choices at all, but they would still be available in help. </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line">&gt; ?</div><div class="line">* You are filling in the sandwich field.Possible responses:</div><div class="line">* You can enter in any words from the descriptions. (BLT, Black Forest Ham, Buffalo Chicken, Chicken And Bacon Ranch Melt, Cold Cut Combo, Meatball Marinara, Over Roasted Chicken, Roast Beef, Rotisserie Style Chicken, Spicy Italian, Steak And Cheese, Sweet Onion Teriyaki, Tuna, Turkey Breast, and Veggie)</div><div class="line">* Back: Go back to the previous question.</div><div class="line">* Help: Show the kinds of responses you can enter.</div><div class="line">* Quit: Quit the form without completing it.</div><div class="line">* Reset: Start over filling in the form. (With defaults of your previous entries.)</div><div class="line">* <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ab2b85bccad5c568fc9db82cac5ab6354aec53a8c4f07baed5d8825072c89799be">Status</a>: Show your progress in filling in the form so far.</div><div class="line">* You can <span class="keywordflow">switch</span> to another field by entering its name. (Sandwich, Length, Bread, Cheese, Sauces, and Toppings).</div></div><!-- fragment --><p>It was great if you wanted to replace just one prompt, but you can also replace the templates that are used for autommatically generating your prompts. Here we have redefined the default template used when you want to select one result from a set of choices to a different string and asked choices to always be listed one per line.  <div class="fragment"><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.EnumSelectOne, <span class="stringliteral">&quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;</span>, ChoiceStyle = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ac6396117e96818e92b4892d316e326d9">ChoiceStyleOptions</a>.PerLine)]</div><div class="line">    <span class="keyword">class </span>SandwichOrder</div></div><!-- fragment --> With this change, here is how the cheese and bread prompts look. </p><div class="fragment"><div class="line">What kind of bread would you like on your sandwich?</div><div class="line"> 1. Nine Grain Wheat</div><div class="line"> 2. Nine Grain Honey Oat</div><div class="line"> 3. Italian</div><div class="line"> 4. Italian Herbs And Cheese</div><div class="line"> 5. Flatbread</div><div class="line">&gt;</div><div class="line">What kind of cheese would you like on your sandwich? </div><div class="line"> 1. American</div><div class="line"> 2. Monterey Cheddar</div><div class="line"> 3. Pepperjack</div><div class="line">&gt; </div></div><!-- fragment --><p> As you can see, both used the new template.</p>
<p>Now, there is still a problem with the SandwichOrder.Cheese field&ndash;how does someone indicate that they do not want cheese at all? One option would be to add an explicit NoCheese value to your enumeration, but a second option is to mark the field as optional using the <a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a> attribute. An optional field has a "special" no preference value. Below is an example of the <a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a> attribute.  <div class="fragment"><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> CheeseOptions? Cheese;</div></div><!-- fragment --> With this change the cheese prompt now looks like this: </p><div class="fragment"><div class="line">What kind of cheese would you like on your sandwich? (current choice: No Preference)</div><div class="line">  1. American</div><div class="line">  2. Monterey Cheddar</div><div class="line">  3. Pepperjack</div><div class="line"> &gt;</div></div><!-- fragment --><p> And if you have a current value it looks like this: </p><div class="fragment"><div class="line">What kind of cheese would you like on your sandwich? (current choice: American)</div><div class="line"> 1. American</div><div class="line"> 2. Monterey Cheddar</div><div class="line"> 3. Pepperjack</div><div class="line"> 4. No Preference</div><div class="line">&gt;</div></div><!-- fragment --><p>One way to interject some variation in the prompts and messages you generate is to define multiple <a class="el" href="forms.html#patterns">Pattern Language</a> patterns to randomly select between. Here we have redefined the <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313aca296fd71c8deadb1bccdad8e097bc50" title="Response when an input is not understood. ">TemplateUsage.NotUnderstood</a> template so that there are two patterns for how to respond to unknown text.  <div class="fragment"><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.NotUnderstood, <span class="stringliteral">&quot;I do not understand \&quot;{0}\&quot;.&quot;</span>, <span class="stringliteral">&quot;Try again, I don&#39;t get \&quot;{0}\&quot;.&quot;</span>)]</div><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.EnumSelectOne, <span class="stringliteral">&quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;</span>, ChoiceStyle = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ac6396117e96818e92b4892d316e326d9">ChoiceStyleOptions</a>.PerLine)]</div><div class="line">    <span class="keyword">class </span>SandwichOrder</div></div><!-- fragment --> Now when the user types something that is not understood, one of the two patterns will be randomly selected like this: </p><div class="fragment"><div class="line">What size of sandwich <span class="keywordflow">do</span> you want? (1. Six Inch, 2. Foot Long)</div><div class="line">&gt; two feet</div><div class="line">I <span class="keywordflow">do</span> not understand <span class="stringliteral">&quot;two feet&quot;</span>.</div><div class="line">&gt; two feet</div><div class="line">Try again, I don<span class="stringliteral">&#39;t get &quot;two feet&quot;</span></div><div class="line"><span class="stringliteral">&gt; </span></div></div><!-- fragment --><p>One of the things you can override are the terms used to match user input to a field or a value in a field. When matching user input, terms are used to identify possible meanings for what was typed.</p>
<p>By default, terms are generated by taking the field or value name and following these steps:</p><ul>
<li>Break on case changes and _.</li>
<li>Generate each n-gram up to a maximum length.</li>
<li>Add s? to the end to support plurals. For example, the value AngusBeefAndGarlicPizza would generate: 'angus?', 'beefs?', 'garlics?', 'pizzas?', 'angus? beefs?', 'garlics? pizzas?' and 'angus beef and garlic pizza'. The word "rotisserie" is one that is highly likely to be misspelled so here we have used a regular expression to make it more likely we will match what the user types. Because we specify Terms.MaxPhrase, Language.GenerateTerms will also generate variations for us.</li>
</ul>
 <div class="fragment"><div class="line">        [Terms(<span class="stringliteral">@&quot;rotis\w* style chicken&quot;</span>, MaxPhrase = 3)]</div><div class="line">        RotisserieStyleChicken, SpicyItalian, SteakAndCheese, SweetOnionTeriyaki, Tuna,</div></div><!-- fragment --></p>
<p>Given the terms now we can match input like this. </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Over Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; rotissary chechen</div><div class="line">For sandwich I understood Rotisserie Style Chicken. <span class="stringliteral">&quot;chechen&quot;</span> is not an option.</div></div><!-- fragment --><h2><a class="anchor" id="logic"></a>
Adding Business Logic</h2>
<p>Sometimes there are complex interdependencies between fields or you need to add logic to setting or getting a value. Here we want to add support for including all toppings except some of them. To do this, we change toppings from a property to a field and add some logic to complement the selected toppings.</p>
 <div class="fragment"><div class="line">        <span class="keyword">public</span> List&lt;ToppingOptions&gt; Toppings</div><div class="line">        {</div><div class="line">            <span class="keyword">get</span> { <span class="keywordflow">return</span> _toppings; }</div><div class="line">            <span class="keyword">set</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (value.Contains(ToppingOptions.Everything))</div><div class="line">                {</div><div class="line">                    _toppings = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                 where topping != ToppingOptions.Everything &amp;&amp; !value.Contains(topping)</div><div class="line">                                 select topping).ToList();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    _toppings = value;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">private</span> List&lt;ToppingOptions&gt; _toppings;</div></div><!-- fragment --></p>
<p>In addition to the processing we also need to add some terms to match expressions like "everything" and "not".  <div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ToppingOptions</div><div class="line">    {</div><div class="line">        <span class="comment">// This starts at 1 because 0 is the &quot;no value&quot; value</span></div><div class="line">        [Terms(<span class="stringliteral">&quot;except&quot;</span>, <span class="stringliteral">&quot;but&quot;</span>, <span class="stringliteral">&quot;not&quot;</span>, <span class="stringliteral">&quot;no&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;everything&quot;</span>)]</div><div class="line">        Everything = 1,</div></div><!-- fragment --></p>
<p>Here is what the interaction with toppings looks like: </p><div class="fragment"><div class="line">Please select one or more toppings (current choice: No Preference)</div><div class="line"> 1. Everything</div><div class="line"> 2. Avocado</div><div class="line"> 3. Banana Peppers</div><div class="line"> 4. Cucumbers</div><div class="line"> 5. Green Bell Peppers</div><div class="line"> 6. Jalapenos</div><div class="line"> 7. Lettuce</div><div class="line"> 8. Olives</div><div class="line"> 9. Pickles</div><div class="line"> 10. Red Onion</div><div class="line"> 11. Spinach</div><div class="line"> 12. Tomatoes</div><div class="line">&gt; everything but jalapenos</div><div class="line">For sandwich toppings you have selected Avocado, Banana Peppers, Cucumbers, Green Bell Peppers, Lettuce, Olives, Pickles, Red Onion, Spinach, and Tomatoes.</div></div><!-- fragment --><h2><a class="anchor" id="ControlFlow"></a>
Using the Form Builder</h2>
<p>So far we have improved your dialog via attributes and business logic. There is another way to improve your dialog and that is through the <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html">FormBuilder</a>. The <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html">FormBuilder</a> allows more fine-grained control over the steps in your conversation and lets you put in messages and more friendly confirmations. By default the steps specified in the builder are executed in order. (Steps might be skipped if there is already a value, or if there is explicit navigation.) Here is a more complex usage of <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html">FormBuilder</a>:  <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildForm()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sandwich))</div><div class="line">                        .Field(nameof(SandwichOrder.Length))</div><div class="line">                        .Field(nameof(SandwichOrder.Bread))</div><div class="line">                        .Field(nameof(SandwichOrder.Cheese))</div><div class="line">                        .Field(nameof(SandwichOrder.Toppings))</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div></div><!-- fragment --></p>
<p>The steps this defines are:</p><ul>
<li>Show the welcome message</li>
<li>Fill in SandwichOrder.Sandwich</li>
<li>Fill in SandwichOrder.Length</li>
<li>Fill in SandwichOrder.Bread</li>
<li>Fill in SandwichOrder.Cheese</li>
<li>Fill in SandwichOrder.Toppings</li>
<li>Show a message confirming the selected toppings.</li>
<li>Fill in SandwichOrder.DeliveryAddress and verify the resulting string. If it does not start with a number we return a message.</li>
<li>Fill in SandwichOrder.DeliveryTime with a custom prompt.</li>
<li>Confirm the order.</li>
<li>Add any remaining fields in the order they are defined in your class. (If this was left out, those steps to fill in those fields would not be included.)</li>
<li>Show a final message thanking them.</li>
</ul>
<p>In the SandwichOrder.DeliveryTime prompt and the confirmation message you can see an instance of the <a class="el" href="forms.html#patterns">Pattern Language</a> where pattern elements like {Length} are filled in from your C# class before the string is shown to the user.</p>
<p><a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html">FormBuilder</a> also allows you to do other more advanced things like dynamically switch on and off parts of your form based on the state of your object or dynamically define fields rather than drive them off a C# class.</p>
<p>Here is the final SandwichOrder with attributes, business logic and a more complex form. </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html">FormFlow</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Linq;</div><div class="line"><span class="preprocessor">#pragma warning disable 649</span></div><div class="line"></div><div class="line"><span class="comment">// The SandwichOrder is the simple form you want to fill out.  It must be serializable so the bot can be stateless.</span></div><div class="line"><span class="comment">// The order of fields defines the default order in which questions will be asked.</span></div><div class="line"><span class="comment">// Enumerations shows the legal options for each field in the SandwichOrder and the order is the order values will be presented </span></div><div class="line"><span class="comment">// in a conversation.</span></div><div class="line"><span class="keyword">namespace </span><a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.Bot.Sample.AnnotatedSandwichBot</div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SandwichOptions</div><div class="line">    {</div><div class="line">        BLT, BlackForestHam, BuffaloChicken, ChickenAndBaconRanchMelt, ColdCutCombo, MeatballMarinara,</div><div class="line">        OverRoastedChicken, RoastBeef,</div><div class="line">        [Terms(<span class="stringliteral">@&quot;rotis\w* style chicken&quot;</span>, MaxPhrase = 3)]</div><div class="line">        RotisserieStyleChicken, SpicyItalian, SteakAndCheese, SweetOnionTeriyaki, Tuna,</div><div class="line">        TurkeyBreast, Veggie</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> LengthOptions { SixInch, FootLong };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> BreadOptions { NineGrainWheat, NineGrainHoneyOat, Italian, ItalianHerbsAndCheese, Flatbread };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> CheeseOptions { American, MontereyCheddar, Pepperjack };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ToppingOptions</div><div class="line">    {</div><div class="line">        <span class="comment">// This starts at 1 because 0 is the &quot;no value&quot; value</span></div><div class="line">        [Terms(<span class="stringliteral">&quot;except&quot;</span>, <span class="stringliteral">&quot;but&quot;</span>, <span class="stringliteral">&quot;not&quot;</span>, <span class="stringliteral">&quot;no&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;everything&quot;</span>)]</div><div class="line">        Everything = 1,</div><div class="line">        Avocado, BananaPeppers, Cucumbers, GreenBellPeppers, Jalapenos,</div><div class="line">        Lettuce, Olives, Pickles, RedOnion, Spinach, Tomatoes</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SauceOptions</div><div class="line">    {</div><div class="line">        ChipotleSouthwest, HoneyMustard, LightMayonnaise, RegularMayonnaise,</div><div class="line">        Mustard, Oil, Pepper, Ranch, SweetOnion, Vinegar</div><div class="line">    };</div><div class="line"></div><div class="line">    [Serializable]</div><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.NotUnderstood, <span class="stringliteral">&quot;I do not understand \&quot;{0}\&quot;.&quot;</span>, <span class="stringliteral">&quot;Try again, I don&#39;t get \&quot;{0}\&quot;.&quot;</span>)]</div><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.EnumSelectOne, <span class="stringliteral">&quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;</span>, ChoiceStyle = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ac6396117e96818e92b4892d316e326d9">ChoiceStyleOptions</a>.PerLine)]</div><div class="line">    <span class="keyword">class </span>SandwichOrder</div><div class="line">    {</div><div class="line">        [Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like? {||}&quot;</span>)]</div><div class="line">        <span class="comment">// [Prompt(&quot;What kind of {&amp;} would you like? {||}&quot;, ChoiceFormat =&quot;{1}&quot;)]</span></div><div class="line">        <span class="comment">// [Prompt(&quot;What kind of {&amp;} would you like?&quot;)]</span></div><div class="line">        <span class="keyword">public</span> SandwichOptions? Sandwich;</div><div class="line"></div><div class="line">        [Prompt(<span class="stringliteral">&quot;What size of sandwich do you want? {||}&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> LengthOptions? Length;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> BreadOptions? Bread;</div><div class="line"></div><div class="line">        <span class="comment">// An optional annotation means that it is possible to not make a choice in the field.</span></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> CheeseOptions? Cheese;</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> List&lt;ToppingOptions&gt; Toppings</div><div class="line">        {</div><div class="line">            <span class="keyword">get</span> { <span class="keywordflow">return</span> _toppings; }</div><div class="line">            <span class="keyword">set</span></div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (value.Contains(ToppingOptions.Everything))</div><div class="line">                {</div><div class="line">                    _toppings = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                 where topping != ToppingOptions.Everything &amp;&amp; !value.Contains(topping)</div><div class="line">                                 select topping).ToList();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    _toppings = value;</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keyword">private</span> List&lt;ToppingOptions&gt; _toppings;</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> List&lt;SauceOptions&gt; Sauces;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> DeliveryAddress;</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313a8cf10d2341ed01492506085688270c1e">DateTime</a>? DeliveryTime;</div><div class="line"></div><div class="line">        [Numeric(1, 5)]</div><div class="line">        [Optional]</div><div class="line">        [Describe(<span class="stringliteral">&quot;your experience today&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">double</span>? Rating;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildForm()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sandwich))</div><div class="line">                        .Field(nameof(SandwichOrder.Length))</div><div class="line">                        .Field(nameof(SandwichOrder.Bread))</div><div class="line">                        .Field(nameof(SandwichOrder.Cheese))</div><div class="line">                        .Field(nameof(SandwichOrder.Toppings))</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sauces))</div><div class="line">                        .Field(nameof(SandwichOrder.DeliveryAddress),</div><div class="line">                            validate: async (state, response) =&gt;</div><div class="line">                            {</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span> };</div><div class="line">                                var address = (response as string).Trim();</div><div class="line">                                <span class="keywordflow">if</span> (address.Length &gt; 0 &amp;&amp; address[0] &lt; <span class="charliteral">&#39;0&#39;</span> || address[0] &gt; <span class="charliteral">&#39;9&#39;</span>)</div><div class="line">                                {</div><div class="line">                                    result.Feedback = <span class="stringliteral">&quot;Address must start with a number.&quot;</span>;</div><div class="line">                                    result.IsValid = <span class="keyword">false</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryTime), <span class="stringliteral">&quot;What time do you want your sandwich delivered? {||}&quot;</span>)</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a70d9be9b139893aa6c69b5e77e614311">Confirm</a>(<span class="stringliteral">&quot;Do you want to order your {Length} {Sandwich} on {Bread} {&amp;Bread} with {[{Cheese} {Toppings} {Sauces}]} to be sent to {DeliveryAddress} {?at {DeliveryTime:t}}?&quot;</span>)</div><div class="line">                        .AddRemainingFields()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Thanks for ordering a sandwich!&quot;</span>)</div><div class="line">                        .Build();</div><div class="line">        }</div><div class="line">    };</div><div class="line">}</div></div><!-- fragment --><p>With all of these improvements, here is what the interaction looks like now. </p><div class="fragment"><div class="line">Welcome to the sandwich order bot!</div><div class="line"></div><div class="line">What kind of sandwich would you like?</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Over Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; 2</div><div class="line">What size of sandwich <span class="keywordflow">do</span> you want? (1. Six Inch, 2. Foot Long)</div><div class="line">&gt; 1</div><div class="line">What kind of bread would you like on your sandwich?</div><div class="line"> 1. Nine Grain Wheat</div><div class="line"> 2. Nine Grain Honey Oat</div><div class="line"> 3. Italian</div><div class="line"> 4. Italian Herbs And Cheese</div><div class="line"> 5. Flatbread</div><div class="line">&gt; nine grain</div><div class="line">By <span class="stringliteral">&quot;nine grain&quot;</span> bread did you mean(1. Nine Grain Honey Oat, 2. Nine Grain Wheat)</div><div class="line">&gt; 1</div><div class="line">What kind of cheese would you like on your sandwich? (current choice: No Preference)</div><div class="line"> 1. American</div><div class="line"> 2. Monterey Cheddar</div><div class="line"> 3. Pepperjack</div><div class="line">&gt; 3</div><div class="line">Please select one or more toppings(current choice: No Preference)</div><div class="line"> 1. Everything</div><div class="line"> 2. Avocado</div><div class="line"> 3. Banana Peppers</div><div class="line"> 4. Cucumbers</div><div class="line"> 5. Green Bell Peppers</div><div class="line"> 6. Jalapenos</div><div class="line"> 7. Lettuce</div><div class="line"> 8. Olives</div><div class="line"> 9. Pickles</div><div class="line"> 10. Red Onion</div><div class="line"> 11. Spinach</div><div class="line"> 12. Tomatoes</div><div class="line">&gt; everything but jalapenos</div><div class="line">For sandwich toppings you have selected Avocado, Banana Peppers, Cucumbers, Green Bell Peppers, Lettuce, Olives, Pickles, Red Onion, Spinach, and Tomatoes.</div><div class="line"></div><div class="line">Please select one or more sauces(current choice: No Preference)</div><div class="line"> 1. Honey Mustard</div><div class="line"> 2. Light Mayonnaise</div><div class="line"> 3. Regular Mayonnaise</div><div class="line"> 4. Mustard</div><div class="line"> 5. Oil</div><div class="line"> 6. Pepper</div><div class="line"> 7. Ranch</div><div class="line"> 8. Sweet Onion</div><div class="line"> 9. Vinegar</div><div class="line">&gt;</div><div class="line">Please enter delivery address</div><div class="line">&gt; 123 State Street</div><div class="line">What time <span class="keywordflow">do</span> you want your sandwich delivered? (current choice: No Preference)</div><div class="line">&gt; 4:30</div><div class="line">Do you want to order your Six Inch Black Forest Ham on Nine Grain Honey Oat bread with Pepperjack, Avocado, Banana Peppers, Cucumbers, Green Bell Peppers, Lettuce, Olives, Pickles, Red Onion, Spinach, and Tomatoes to be sent to 123 State Street at 4:30 PM?</div><div class="line">&gt; y</div><div class="line">Please enter a number between 1.0 and 5.0 <span class="keywordflow">for</span> your experience today(current choice: No Preference)</div><div class="line">&gt; 5</div><div class="line">Thanks <span class="keywordflow">for</span> ordering a sandwich!</div></div><!-- fragment --><h1><a class="anchor" id="initialState"></a>
Passing in Initial Form State and Entities</h1>
<p>When you launch a <a class="el" href="db/de5/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_dialog.html" title="Form dialog manager for to fill in your state. ">FormDialog</a>, you can optionally pass in an instance of your state. If you do that, any step for filling a field is skipped if that field has a value. You can also pass in <a href="http://luis.ai" title="LUIS">LUIS</a> entities to bind to the state. If the <a class="el" href="d5/dd8/class_microsoft_1_1_bot_1_1_builder_1_1_luis_1_1_entity_recommendation.html#a03581de273a9305988451304fdaca77c">EntityRecommendation.Type</a> is a path to a field in your C# class then the <a class="el" href="d5/dd8/class_microsoft_1_1_bot_1_1_builder_1_1_luis_1_1_entity_recommendation.html#aec5640585d240807dfffca95ee8630fa">EntityRecommendation.Entity</a> will be passed through the recognizer to bind to your field. Just like initial state, any step for filling in that field will be skipped.</p>
<h1><a class="anchor" id="patterns"></a>
Pattern Language</h1>
<p>One of the keys to creating a bot is being able to generate text that is clear and meaningful to the bot user. This framework supports a pattern language with elements that can be filled in at runtime. Everything in a pattern that is not surrounded by curly braces is just passed straight through. Anything in curly braces is substitued with values to make a string that can be shown to the user. Once substitution is done, some additional processing to remove double spaces and use the proper form of a/an is also done.</p>
<p>Possible curly brace pattern elements are outlined in the table below. Within a pattern element, "&lt;field&gt;" refers to the path within your form class to get to the field value. So if I had a class with a field named "Size" you would refer to the size value with the pattern element {Size}. "..." within a pattern element means multiple elements are allowed. "&lt;format&gt;" within a pattern element means that you can optionally specify a regular C# format specifier, i.e. if "Rating" were a double field I could show it with two digits of precision by using the pattern element "{Rating:F2}". "&lt;n&gt;" shows where you can specify a reference to the nth argument of a template. (See TemplateUsage to see what arguments each template can use.)</p>
<table class="doxtable">
<tr>
<th>Pattern Element </th><th>Description  </th></tr>
<tr>
<td>{&lt;format&gt;} </td><td>Value of the current field. </td></tr>
<tr>
<td>{&amp;} </td><td>Description of the current field. </td></tr>
<tr>
<td>{&lt;field&gt;&lt;format&gt;} </td><td>Value of a particular field. </td></tr>
<tr>
<td>{&amp;&lt;field&gt;} </td><td>Description of a particular field. </td></tr>
<tr>
<td>{||} </td><td>Show the current choices for enumerated fields. </td></tr>
<tr>
<td>{[{&lt;field&gt;&lt;format&gt;} ...]} </td><td>Create a list with all field values together utilizing <a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#aa55384cb431ff75190efe7abd2fdb6a7">Separator</a> and <a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a72a59330fcdc04cf70b922c6d217d44c">LastSeparator</a> to separate the individual values. </td></tr>
<tr>
<td>{*} </td><td>Show one line for each active field with the description and current value. </td></tr>
<tr>
<td>{*filled} </td><td>Show one line for each active field that has an actual value with the description and current value. </td></tr>
<tr>
<td>{&lt;nth&gt;&lt;format&gt;} </td><td>A regular C# format specifier that refers to the nth arg. See TemplateUsage to see what args are available. </td></tr>
<tr>
<td>{?&lt;textOrPatternElement&gt;...} </td><td>Conditional substitution. If all referred to pattern elements have values, the values are substituted and the whole expression is used. </td></tr>
</table>
<p>Patterns are used in <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> and <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> annotations. <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> defines a prompt to the user for a particular field or confirmation. <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> is used to automatically construct prompts and other things like help. There is a built-in set of templates defined in <a class="el" href="de/db8/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_configuration.html#a40fe1b7c1bb62d7ae2accb8501a597a5" title="Default templates to use if not override on the class or field level. ">FormConfiguration.Templates</a>. A good way to see examples of the pattern language is to look at the templates defined there. A <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> can be specified by annotating a particular field or property or implicitly defined through IField&lt;T&gt;.Field. A default <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> can be overridden on a class or field basis. Both prompts and templates support the formatting parameters outlined below.</p>
<table class="doxtable">
<tr>
<th>Usage </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a07d2759e7867bc1e885bfd7d856a27a2">AllowDefault</a> </td><td>When processing choices using {||} controls whether the current value should be showed as a choice. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a6c9b5b59599cd48b048831a558d61aa1">ChoiceFormat</a> </td><td>When processing choices using {||} controls how each choice is formatted. {0} is the choice number and {1} the choice description. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a897a99309a7705ccb35a723904593745">ChoiceStyle</a> </td><td>When processing choices using {||} controls whether the choices are presented in line or per line. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#af025c76078551917a3ee3f0d67ce4cfc">Feedback</a> </td><td>For <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> only controls feedback after user entry. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a2325d2ddd4dd311a57af57d2039c1950">FieldCase</a> </td><td>Controls case normalization when displaying a field description. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a72a59330fcdc04cf70b922c6d217d44c">LastSeparator</a> </td><td>When lists are constructed for {[]} or in line choices from {||} provides the separator before the last item. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#aa55384cb431ff75190efe7abd2fdb6a7">Separator</a> </td><td>When lists are constructed for {[]} or in line choices from {||} provides the separator before every item except the last. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a3de7c77ed975e3cf5ba13679e5d3e2f5">ValueCase</a> </td><td>Controls case normalization when displaying a field value. </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<!-- id is needed for treeview function! -->
<div class="outline footer">
	<ul>
        <li><a href="//aka.ms/bf-contactus">Contact us</a></li>
        <li><a href="//aka.ms/bf-privacy">Privacy & cookies</a></li>
        <li><a href="//aka.ms/bf-terms">Terms of use</a></li>
        <li><a href="//aka.ms/bf-conduct">Code of conduct</a></li>
        <li>&copy; 2016 Microsoft</li>
	</ul>
</div>
<script src="//intercom-ppe.azureedge.net/libs/svgxuse.js"></script>
</body>
</html>
