<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>FormFlow | Bot Builder SDK C# Reference Library | Bot Framework</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="botframework.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="/css/documentation.css?1" />
    <script type="text/javascript" src="/css/documents.js"></script>
    <!-- START OF SmartSource Data Collector TAG v10.4.23 -->
    <!-- Copyright (c) 2016 Webtrends Inc.  All rights reserved. -->
    <script type="text/javascript" src="/js/webtrends.load.js"></script>
    <!--
      appInsights
    -->
    <script type="text/javascript">
    var appInsights=window.appInsights||function(config){
      function r(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},u=document,e=window,o="script",s=u.createElement(o),i,f;for(s.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",u.getElementsByTagName(o)[0].parentNode.appendChild(s),t.cookie=u.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)r("track"+i.pop());return r("setAuthenticatedUserContext"),r("clearAuthenticatedUserContext"),config.disableExceptionTracking||(i="onerror",r("_"+i),f=e[i],e[i]=function(config,r,u,e,o){var s=f&&f(config,r,u,e,o);return s!==!0&&t["_"+i](config,r,u,e,o),s}),t
      }({
          instrumentationKey:"ecf7f29d-de8c-4169-a492-bdce0a32c300"
      });
      window.appInsights=appInsights;
      appInsights.trackPageView();
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            var sidenav = $('#side-nav');
            sidenav.before('<div id="content-container" class="outline"></div>');
            var doccontent = $('#doc-content');
			var contentcontainer = $('#content-container');
            contentcontainer.append(sidenav);
            contentcontainer.append(doccontent);
            doccontent.prepend($('#referenceSearch'));
			var top = $('#top');
			top.before('<div class="fullWidth"></div>');
			var fullwidth = $('div.fullWidth');
			fullwidth.before('<div id="app-body"></div>');
			fullwidth.append(top);
			fullwidth.append(contentcontainer);
			fullwidth.append($('.footer'));
			var appbody = $('#app-body');
			appbody.append(fullwidth);
			var navtreecontents = $('#nav-tree-contents');
			navtreecontents.prepend('<ul><li><div class="label"><a href="/">&lt; Documentation Home</a></div></li></ul>');
			//sidenav.prepend('<div id="wrapper"><form id="docs-search-form" action="/en-us/search/"><input id="q" name="q" type="text" placeholder=""><input type="hidden" id="v" name="v" value="v3"><input type="hidden" id="mkt" name="mkt" value="en-us"><button id="bt_search" name="bt_search" class="icon-search" type="submit"></button></form></div>');
            //sidenav.prepend('<div id="wrapper"><form id="docs-search-form" action="/en-us/search/"><select id="lang-select" name="lang" ><option value="">All</option><option value="node">Node.js</option><option value="csharp">.NET</option></select><input id="q" name="q" type="text" placeholder=""><input type="hidden" id="v" name="v" value="v3"><input type="hidden" id="mkt" name="mkt" value="en-us"><button id="bt_search" name="bt_search" class="icon-search" type="submit"></button></form></div>');
            setProgrammingLanguage();
			$('#MSearchField').removeAttr('value').attr('placeholder', 'Search the Bot Builder SDK C# reference');
        });
    </script>
</head>
<body>
    <div id="referenceSearch"></div>
    <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div>
            <header>
                <div class="outline">
                    <div class="header">
                        <a class="logo" href="//www.microsoft.com">
                            <svg class="svgicon svgicon-microsoft-color-logo">
                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/images/symbol-defs.svg#svgicon-microsoft-color-logo"></use>
                            </svg>
                        </a>
                        <div class="loading-animation"></div>
                        <span class="environment"></span>
                        <div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="brand-primary">
                <div class="jumbo">
                    <div class="jumbo-header"><a href="https://www.botframework.com/">Bot Framework</a></div>
                    <ul class="header-nav">
                        <li><a href="https://dev.botframework.com/#/bots">My bots</a></li>
                        <li><a href="https://dev.botframework.com/#/bots/new">Register a bot</a></li>
                        <li class="active"><a href="/">Documentation</a></li>
                        <li><a href="https://bots.botframework.com/">Bot Directory</a></li>
                        <li><a href="https://blog.botframework.com/">Blog</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- end header part -->
</body>
</html><!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('forms.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">FormFlow </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p><a class="el" href="dialogs.html">Dialogs</a> are very powerful and flexible, but handling a guided conversation like ordering a sandwich can require a lot of effort. At each point in the dialog, there are many possibilities for what happens next. You may need to clarify an ambiguity, provide help, go back or show progress so far. In order to simplify building guided conversations the framework provides a powerful dialog building block known as FormFlow. FormFlow sacrifices some of the flexibility provided by dialogs, but in a way that requires much less effort. Even better, you can combine FormFlow generate dialogs and other kinds of dialogs like a <a class="el" href="d8/df9/class_microsoft_1_1_bot_1_1_builder_1_1_dialogs_1_1_luis_dialog.html">LuisDialog</a> to get the best of both worlds. A FormFlow dialog guides the user through filling in the form while providing help and guidance along the way.</p>
<p>The clearest way to understand this is to take a look at the <a class="el" href="forms.html#simpleSandwichBot">Simple Sandwich Bot</a> sample. In that sample you define the form you want using C# classes, fields and properties. That is all you need to do to get a pretty good dialog that supports help, clarification, status and navigation without any more effort. Once you have that base you can make use of C# attributes and <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a> to improve your bot in a straightforward way as shown in the <a class="el" href="forms.html#annotatedSandwich">Improved Sandwich Bot</a> example.</p>
<h1><a class="anchor" id="fields"></a>
Forms and Fields</h1>
<p>FormFlow starts with the idea of a form&ndash;a collection of fields that you want to fill in through a conversation with the user. The simplest way to describe a form is through a C# class. Within a class, a "field" is any public field or property with one of the following types:</p><ul>
<li>Integral &ndash; sbyte, byte, short, ushort, int, uint, long, ulong</li>
<li>Floating point &ndash; float, double</li>
<li>String</li>
<li>DateTime</li>
<li>Enum</li>
<li>List of enum</li>
</ul>
<p>Any of the data types can also be nullable which is a good way to model that the field does not have a value. If a field is based on an enum and it is not nullable, then the 0 value in the enum is considered to be null and you should start your enumeration at 1. Any other fields, properties or methods are ignored by the FormFlow code. In order to handle a list of complex objects, you need to create a form for the top level C# class and also one for the complex object. You can use the <a class="el" href="dialogs.html">Dialogs</a> system to compose the forms together. It is also possible to define a form directly by implementing <a class="el" href="d5/d09/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_i_field.html" title="Interface for all the information about a specific field. ">Advanced.IField</a> or using <a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html" title="Base class with declarative implementation of IField. ">Advanced.Field</a> and populating the dictionaries within it. In order to better understand <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html" title="Core namespace for FormFlow and associated infrastructure.">FormFlow</a> and its capabilities we will work through two examples, <a class="el" href="forms.html#simpleSandwichBot">Simple Sandwich Bot</a> where everything is automatically generated and <a class="el" href="forms.html#annotatedSandwich">Improved Sandwich Bot</a> where the form is extensively customized.</p>
<h1><a class="anchor" id="simpleSandwichBot"></a>
Simple Sandwich Bot</h1>
<p>As an example of FormFlow in action, we will outline a simple sandwich ordering form that will be elaborated in <a class="el" href="forms.html#annotatedSandwich">Improved Sandwich Bot</a> to show various features. To start with FormFlow you need to create a C# class to define the form you want to fill in. Like this: </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html">FormFlow</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><span class="preprocessor">#pragma warning disable 649</span></div><div class="line"></div><div class="line"><span class="comment">// The SandwichOrder is the simple form you want to fill out.  It must be serializable so the bot can be stateless.</span></div><div class="line"><span class="comment">// The order of fields defines the default order in which questions will be asked.</span></div><div class="line"><span class="comment">// Enumerations shows the legal options for each field in the SandwichOrder and the order is the order values will be presented </span></div><div class="line"><span class="comment">// in a conversation.</span></div><div class="line"><span class="keyword">namespace </span><a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.Bot.Sample.SimpleSandwichBot</div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SandwichOptions</div><div class="line">    {</div><div class="line">        BLT, BlackForestHam, BuffaloChicken, ChickenAndBaconRanchMelt, ColdCutCombo, MeatballMarinara,</div><div class="line">        OvenRoastedChicken, RoastBeef, RotisserieStyleChicken, SpicyItalian, SteakAndCheese, SweetOnionTeriyaki, Tuna,</div><div class="line">        TurkeyBreast, Veggie</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> LengthOptions { SixInch, FootLong };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> BreadOptions { NineGrainWheat, NineGrainHoneyOat, Italian, ItalianHerbsAndCheese, Flatbread };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> CheeseOptions { American, MontereyCheddar, Pepperjack };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ToppingOptions</div><div class="line">    {</div><div class="line">        Avocado, BananaPeppers, Cucumbers, GreenBellPeppers, Jalapenos,</div><div class="line">        Lettuce, Olives, Pickles, RedOnion, Spinach, Tomatoes</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SauceOptions</div><div class="line">    {</div><div class="line">        ChipotleSouthwest, HoneyMustard, LightMayonnaise, RegularMayonnaise,</div><div class="line">        Mustard, Oil, Pepper, Ranch, SweetOnion, Vinegar</div><div class="line">    };</div><div class="line"></div><div class="line">    [Serializable]</div><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>SandwichOrder</div><div class="line">    {</div><div class="line">        <span class="keyword">public</span> SandwichOptions? Sandwich;</div><div class="line">        <span class="keyword">public</span> LengthOptions? Length;</div><div class="line">        <span class="keyword">public</span> BreadOptions? Bread;</div><div class="line">        <span class="keyword">public</span> CheeseOptions? Cheese;</div><div class="line">        <span class="keyword">public</span> List&lt;ToppingOptions&gt; Toppings;</div><div class="line">        <span class="keyword">public</span> List&lt;SauceOptions&gt; Sauce;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildForm()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                    .Message(<span class="stringliteral">&quot;Welcome to the simple sandwich order bot!&quot;</span>)</div><div class="line">                    .Build();</div><div class="line">        }</div><div class="line">    };</div><div class="line">}</div></div><!-- fragment --><p> You can see how we import the core <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html" title="Core namespace for FormFlow and associated infrastructure.">Microsoft.Bot.Builder.FormFlow</a> namespace and then define our class. Included in the class is a static method BuildForm that uses a <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a> to build your form. There are lots of things you can do with the form builder, but we will cover that later and here we just define a simple welcome message.</p>
<p>In order to connect your form to the bot framework you need to add it to your controller like this:  <div class="fragment"><div class="line">        <span class="keyword">internal</span> <span class="keyword">static</span> IDialog&lt;SandwichOrder&gt; MakeRootDialog()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> Chain.From(() =&gt; FormDialog.FromForm(SandwichOrder.BuildForm));</div><div class="line">        }</div><div class="line"></div><div class="line">        [ResponseType(typeof(<span class="keywordtype">void</span>))]</div><div class="line">        <span class="keyword">public</span> <span class="keyword">virtual</span> async Task&lt;HttpResponseMessage&gt; Post([FromBody] Activity activity)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (activity != null)</div><div class="line">            {</div><div class="line">                <span class="comment">// one of these will have an interface and process it</span></div><div class="line">                <span class="keywordflow">switch</span> (activity.GetActivityType())</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">case</span> ActivityTypes.Message:</div><div class="line">                        await Conversation.SendAsync(activity, MakeRootDialog);</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">                    <span class="keywordflow">case</span> ActivityTypes.ConversationUpdate:</div><div class="line">                    <span class="keywordflow">case</span> ActivityTypes.ContactRelationUpdate:</div><div class="line">                    <span class="keywordflow">case</span> ActivityTypes.Typing:</div><div class="line">                    <span class="keywordflow">case</span> ActivityTypes.DeleteUserData:</div><div class="line">                    <span class="keywordflow">default</span>:</div><div class="line">                        Trace.TraceError($<span class="stringliteral">&quot;Unknown activity type ignored: {activity.GetActivityType()}&quot;</span>);</div></div><!-- fragment --></p>
<p>The combination of your C# class and connecting it to the Bot Framework is enough to automatically create a conversation. Here is an example interaction that demonstrates some of the features offered by FormFlow. A <b>&gt;</b> symbol shows where a response is expected from the user and any input that was entered at that point in the dialog. </p><div class="fragment"><div class="line">Please select a sandwich</div><div class="line">1. BLT</div><div class="line">2. Black Forest Ham</div><div class="line">3. Buffalo Chicken</div><div class="line">4. Chicken And Bacon Ranch Melt</div><div class="line">5. Cold Cut Combo</div><div class="line">6. Meatball Marinara</div><div class="line">7. Oven Roasted Chicken</div><div class="line">8. Roast Beef</div><div class="line">9. Rotisserie Style Chicken</div><div class="line">10. Spicy Italian</div><div class="line">11. Steak And Cheese</div><div class="line">12. Sweet Onion Teriyaki</div><div class="line">13. Tuna</div><div class="line">14. Turkey Breast</div><div class="line">15. Veggie</div><div class="line">&gt;</div></div><!-- fragment --><p>Here you can see the field SandwichOrder.Sandwich being filled in. First off you can see the automatically generated prompt "Please select a sandwich". The word "sandwich" came from the name of the field. The SandwichOptions enumeration provided the choices that make up the list. Each enumeration was broken into words based on changes in case and underscores.</p>
<p>Now what are the possible responses? If you ask for "help" you can see this: </p><div class="fragment"><div class="line">&gt; help</div><div class="line">* You are filling in the sandwich field. Possible responses:</div><div class="line">* You can enter a number 1-15 or words from the descriptions. (BLT, Black Forest Ham, Buffalo Chicken, Chicken And Bacon Ranch Melt, Cold Cut Combo, Meatball Marinara, Oven Roasted Chicken, Roast Beef, Rotisserie Style Chicken, Spicy Italian, Steak And Cheese, Sweet Onion Teriyaki, Tuna, Turkey Breast, and Veggie)</div><div class="line">* Back: Go back to the previous question.</div><div class="line">* Help: Show the kinds of responses you can enter.</div><div class="line">* Quit: Quit the form without completing it.</div><div class="line">* Reset: Start over filling in the form. (With defaults from your previous entries.)</div><div class="line">* <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ab2b85bccad5c568fc9db82cac5ab6354aec53a8c4f07baed5d8825072c89799be">Status</a>: Show your progress in filling in the form so far.</div><div class="line">* You can <span class="keywordflow">switch</span> to another field by entering its name. (Sandwich, Length, Bread, Cheese, Toppings, and Sauce).</div></div><!-- fragment --><p>As described in the help, you can respond to this prompt by responding with the number of the choice you want, or you can also use the words that are found in the choice descriptions. There are also a number of commands that let you back up a step, get help, quit, start over or get the progress so far. Let's enter "2" to select "Black Forest Ham". </p><div class="fragment"><div class="line"> Please select a sandwich</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Oven Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; 2</div><div class="line">Please select a length(1. Six Inch, 2. Foot Long)</div><div class="line">&gt; </div></div><!-- fragment --><p>Now we get the next prompt which is for the SandwichOrder.Length property. If you wanted to back up to check on your change, you could type 'back' like this: </p><div class="fragment"><div class="line">&gt; back</div><div class="line">Please select a sandwich(current choice: Black Forest Ham)</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Oven Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div></div><!-- fragment --><p>Now we can see that we selected "Black Forest Ham" and we can continue by typing "c" to keep the current choice and "1" to select a six inch sandwich. </p><div class="fragment"><div class="line">Please select a sandwich (current choice: Black Forest Ham)</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Oven Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; c</div><div class="line">Please select a length(1. Six Inch, 2. Foot Long)</div><div class="line">&gt; 1</div></div><!-- fragment --><p>In addition to typing numbers and commands you can also type in words from the choices. Here we have typed "nine grain" which is ambiguous and the <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html" title="Core namespace for FormFlow and associated infrastructure.">FormFlow</a> system automatically asks for clarification. </p><div class="fragment"><div class="line">Please select a bread</div><div class="line"> 1. Nine Grain Wheat</div><div class="line"> 2. Nine Grain Honey Oat</div><div class="line"> 3. Italian</div><div class="line"> 4. Italian Herbs And Cheese</div><div class="line"> 5. Flatbread</div><div class="line">&gt; nine grain</div><div class="line">By <span class="stringliteral">&quot;nine grain&quot;</span> bread did you mean(1. Nine Grain Honey Oat, 2. Nine Grain Wheat)</div><div class="line">&gt; 1</div></div><!-- fragment --><p>What happens if you type in something which is not understood or a mixture of understood and not understood words? In the below you can see both something that is not understood at all and also a mixture of understood and not understood things. </p><div class="fragment"><div class="line">Please select a cheese (1. American, 2. Monterey Cheddar, 3. Pepperjack)</div><div class="line">&gt; amercan</div><div class="line"><span class="stringliteral">&quot;amercan&quot;</span> is not a cheese option.</div><div class="line">&gt; american smoked</div><div class="line">For cheese I understood American. <span class="stringliteral">&quot;smoked&quot;</span> is not an option.</div></div><!-- fragment --><p>Some fields like SandwichOrder.Toppings allow multiple choices. Here we are entering multiple choices and showing another example of clarification. </p><div class="fragment"><div class="line">Please select one or more toppings</div><div class="line"> 1. Banana Peppers</div><div class="line"> 2. Cucumbers</div><div class="line"> 3. Green Bell Peppers</div><div class="line"> 4. Jalapenos</div><div class="line"> 5. Lettuce</div><div class="line"> 6. Olives</div><div class="line"> 7. Pickles</div><div class="line"> 8. Red Onion</div><div class="line"> 9. Spinach</div><div class="line"> 10. Tomatoes</div><div class="line">&gt; peppers, lettuce and tomato</div><div class="line">By <span class="stringliteral">&quot;peppers&quot;</span> toppings did you mean(1. Green Bell Peppers, 2. Banana Peppers)</div><div class="line">&gt; 1</div></div><!-- fragment --><p>At this point, I might wonder how much is left and I can ask about my progress so far by typing "status". When I do so, I see my form and all that is left to fill out is my SandwichOrder.Sauce. </p><div class="fragment"><div class="line">Please select one or more sauce</div><div class="line"> 1. Honey Mustard</div><div class="line"> 2. Light Mayonnaise</div><div class="line"> 3. Regular Mayonnaise</div><div class="line"> 4. Mustard</div><div class="line"> 5. Oil</div><div class="line"> 6. Pepper</div><div class="line"> 7. Ranch</div><div class="line"> 8. Sweet Onion</div><div class="line"> 9. Vinegar</div><div class="line">&gt; status</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Six Inch</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313a6fcdc090caeade09d0efd6253932b6f5">Unspecified</a>  </div></div><!-- fragment --><p>I select "1" for "Honey Mustard" and I've reached the end and I'm asked to confirm my order. </p><div class="fragment"><div class="line">Please select one or more sauce</div><div class="line"> 1. Honey Mustard</div><div class="line"> 2. Light Mayonnaise</div><div class="line"> 3. Regular Mayonnaise</div><div class="line"> 4. Mustard</div><div class="line"> 5. Oil</div><div class="line"> 6. Pepper</div><div class="line"> 7. Ranch</div><div class="line"> 8. Sweet Onion</div><div class="line"> 9. Vinegar</div><div class="line">&gt; 1</div><div class="line">Is <span class="keyword">this</span> your selection?</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Six Inch</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: Honey Mustard</div><div class="line">&gt;</div></div><!-- fragment --><p>If I say "no", then I get the option to change any part of the form. In this case I change the length and then say "y" which then returns the completed form to the caller. </p><div class="fragment"><div class="line">Is <span class="keyword">this</span> your selection?</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Six Inch</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: Honey Mustard</div><div class="line">&gt; no</div><div class="line">What <span class="keywordflow">do</span> you want to change?</div><div class="line"> 1. Sandwich(Black Forest Ham)</div><div class="line"> 2. Length(Six Inch)</div><div class="line"> 3. Bread(Nine Grain Honey Oat)</div><div class="line"> 4. Cheese(American)</div><div class="line"> 5. Toppings(Lettuce, Tomatoes, and Green Bell Peppers)</div><div class="line"> 6. Sauce(Honey Mustard)</div><div class="line">&gt; 2</div><div class="line">Please select a length(current choice: Six Inch) (1. Six Inch, 2. Foot Long)</div><div class="line">&gt; 2</div><div class="line">Is <span class="keyword">this</span> your selection?</div><div class="line">* Sandwich: Black Forest Ham</div><div class="line">* Length: Foot Long</div><div class="line">* Bread: Nine Grain Honey Oat</div><div class="line">* Cheese: American</div><div class="line">* Toppings: Lettuce, Tomatoes, and Green Bell Peppers</div><div class="line">* Sauce: Honey Mustard</div><div class="line"></div><div class="line">&gt; y</div></div><!-- fragment --><p> At this point, the form is completed and will be returned to the parent dialog. Throughout this interaction you can see that the automatically generated conversation:</p><ul>
<li>Provided clear guidance and help</li>
<li>Understands both numbers and textual entries</li>
<li>Gives feedback on what is understood and what is not.</li>
<li>Asks clarifying questions when needed.</li>
<li>Allows navigating between the steps.</li>
</ul>
<p>All of this is pretty amazing for not having to do any of the work! However, not every interaction was as good as you might want it to be. That is why there are easy ways to provide:</p><ul>
<li>Messages during the process of filling in a form.</li>
<li>Custom prompts per field.</li>
<li>Templates to use when automatically generating prompts or help.</li>
<li>Terms to match on.</li>
<li>Whether to show choices and numbers or not.</li>
<li>Fields that are optional.</li>
<li>Conditional fields.</li>
<li>Value validation</li>
<li>and much more...</li>
</ul>
<p>The next example shows how to improve the sandwich bot with attributes, business logic and the <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a>.</p>
<h1><a class="anchor" id="annotatedSandwich"></a>
Improved Sandwich Bot</h1>
<p>This example builds on the previous one by:</p><ul>
<li>Adding some new field types including string and DateTime.</li>
<li>Adding attributes to add descriptions, terms, prompts and templates.</li>
<li>Switching from fields to properties to incorporate business logic.</li>
<li>Adding messages, flow control and confirmations.</li>
</ul>
<h2><a class="anchor" id="attributes"></a>
Attributes</h2>
<p>FormFlow includes some C# attributes you can add to your class to better control the dialog. Here are the attributes:</p>
<table class="doxtable">
<tr>
<th>Attribute </th><th>Purpose  </th></tr>
<tr>
<td><a class="el" href="dd/d38/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_describe_attribute.html">Describe</a> </td><td>Change how a field or a value is shown in a template as a choice or in a card. </td></tr>
<tr>
<td><a class="el" href="df/d31/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_numeric_attribute.html">Numeric</a> </td><td>Provide limits on the values accepted in a numeric field. </td></tr>
<tr>
<td><a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a></td><td>Mark a field as optional which means that one choice is not to supply a value. </td></tr>
<tr>
<td><a class="el" href="da/d2b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_pattern_attribute.html">Pattern</a> </td><td>Define a regular expression to validate a string field. </td></tr>
<tr>
<td><a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a></td><td>Define a prompt to use when asking for a field. </td></tr>
<tr>
<td><a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> </td><td>Define a template that is used to generate prompts or values in prompts. </td></tr>
<tr>
<td><a class="el" href="d2/d27/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_terms_attribute.html">Terms</a> </td><td>Define the input terms that match a field or value. </td></tr>
</table>
<p>Let's look at how these attributes can improve your bot. First off, we might want to change the the prompt for SandwichOrder.Sandwich from the automatically generated "Please select a sandwich" to "What kind of sandwich would you like?". To do this we would use the <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> attribute like this:  <div class="fragment"><div class="line">        [Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like? {||}&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> SandwichOptions? Sandwich;</div></div><!-- fragment --></p>
<p>One thing you will notice is the the prompt contains the funny strings "{&amp;}" and "{||}". That is because prompt and message strings are written in <a class="el" href="forms.html#patterns">Pattern Language</a> where you can have parts of the string that are filled in when the actual prompt or message is generated. In this case "{&amp;}" means fill in the description of the field and "{||}" means show the choices that are possible. The description of a field is automatically generated from the field name, but you could also use a Describe attribute to override that. By adding this attribute, the prompt for SandwichOrder.Sandwich now looks like: </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line">1. BLT</div><div class="line">2. Black Forest Ham</div><div class="line">3. Buffalo Chicken</div><div class="line">4. Chicken And Bacon Ranch Melt</div><div class="line">5. Cold Cut Combo</div><div class="line">6. Meatball Marinara</div><div class="line">7. Oven Roasted Chicken</div><div class="line">8. Roast Beef</div><div class="line">9. Rotisserie Style Chicken</div><div class="line">10. Spicy Italian</div><div class="line">11. Steak And Cheese</div><div class="line">12. Sweet Onion Teriyaki</div><div class="line">13. Tuna</div><div class="line">14. Turkey Breast</div><div class="line">15. Veggie</div><div class="line">&gt;</div></div><!-- fragment --><p>There are lots of things you can control when specifying a prompt. For example with this prompt attribute: </p><div class="fragment"><div class="line">[Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like? {||}&quot;</span>, ChoiceFormat=<span class="stringliteral">&quot;{1}&quot;</span>)]</div></div><!-- fragment --><p> The prompt would now no longer show numbers and the only accepted input would be words from the choices. </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line">* BLT</div><div class="line">* Black Forest Ham</div><div class="line">* Buffalo Chicken</div><div class="line">* Chicken And Bacon Ranch Melt</div><div class="line">* Cold Cut Combo</div><div class="line">* Meatball Marinara</div><div class="line">* Oven Roasted Chicken</div><div class="line">* Roast Beef</div><div class="line">* Rotisserie Style Chicken</div><div class="line">* Spicy Italian</div><div class="line">* Steak And Cheese</div><div class="line">* Sweet Onion Teriyaki</div><div class="line">* Tuna</div><div class="line">* Turkey Breast</div><div class="line">* Veggie</div><div class="line">&gt;</div></div><!-- fragment --><p>Going a step further, you could decide not to show the choices at all like this: </p><div class="fragment"><div class="line">[Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like?&quot;</span>)]</div></div><!-- fragment --><p> The prompt then would not show the choices at all, but they would still be available in help. </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line">&gt; ?</div><div class="line">* You are filling in the sandwich field. Possible responses:</div><div class="line">* You can enter in any words from the descriptions. (BLT, Black Forest Ham, Buffalo Chicken, Chicken And Bacon Ranch Melt, Cold Cut Combo, Meatball Marinara, Oven Roasted Chicken, Roast Beef, Rotisserie Style Chicken, Spicy Italian, Steak And Cheese, Sweet Onion Teriyaki, Tuna, Turkey Breast, and Veggie)</div><div class="line">* Back: Go back to the previous question.</div><div class="line">* Help: Show the kinds of responses you can enter.</div><div class="line">* Quit: Quit the form without completing it.</div><div class="line">* Reset: Start over filling in the form. (With defaults from your previous entries.)</div><div class="line">* <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ab2b85bccad5c568fc9db82cac5ab6354aec53a8c4f07baed5d8825072c89799be">Status</a>: Show your progress in filling in the form so far.</div><div class="line">* You can <span class="keywordflow">switch</span> to another field by entering its name. (Sandwich, Length, Bread, Cheese, Sauces, and Toppings).</div></div><!-- fragment --><p>It was great if you wanted to replace just one prompt, but you can also replace the templates that are used for automatically generating your prompts. Here we have redefined the default template used when you want to select one result from a set of choices to a different string and asked choices to always be listed one per line. </p><div class="fragment"><div class="line">[Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.EnumSelectOne, <span class="stringliteral">&quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;</span>, ChoiceStyle = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ac6396117e96818e92b4892d316e326d9">ChoiceStyleOptions</a>.PerLine)]</div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SandwichOrder</div></div><!-- fragment --><p> With this change, here is how the cheese and bread prompts look. </p><div class="fragment"><div class="line">What kind of bread would you like on your sandwich?</div><div class="line"> 1. Nine Grain Wheat</div><div class="line"> 2. Nine Grain Honey Oat</div><div class="line"> 3. Italian</div><div class="line"> 4. Italian Herbs And Cheese</div><div class="line"> 5. Flatbread</div><div class="line">&gt;</div><div class="line">What kind of cheese would you like on your sandwich? </div><div class="line"> 1. American</div><div class="line"> 2. Monterey Cheddar</div><div class="line"> 3. Pepperjack</div><div class="line">&gt; </div></div><!-- fragment --><p> As you can see, both used the new template.</p>
<p>Now, there is still a problem with the SandwichOrder.Cheese field&ndash;how does someone indicate that they do not want cheese at all? One option would be to add an explicit NoCheese value to your enumeration, but a second option is to mark the field as optional using the <a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a> attribute. An optional field has a "special" no preference value. Below is an example of the <a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a> attribute.  <div class="fragment"><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> CheeseOptions? Cheese;</div></div><!-- fragment --> With this change the cheese prompt now looks like this: </p><div class="fragment"><div class="line">What kind of cheese would you like on your sandwich? (current choice: No Preference)</div><div class="line">  1. American</div><div class="line">  2. Monterey Cheddar</div><div class="line">  3. Pepperjack</div><div class="line"> &gt;</div></div><!-- fragment --><p> And if you have a current value it looks like this: </p><div class="fragment"><div class="line">What kind of cheese would you like on your sandwich? (current choice: American)</div><div class="line"> 1. American</div><div class="line"> 2. Monterey Cheddar</div><div class="line"> 3. Pepperjack</div><div class="line"> 4. No Preference</div><div class="line">&gt;</div></div><!-- fragment --><p>One way to interject some variation in the prompts and messages you generate is to define multiple <a class="el" href="forms.html#patterns">Pattern Language</a> patterns to randomly select between. Here we have redefined the <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313aca296fd71c8deadb1bccdad8e097bc50" title="Response when an input is not understood. ">TemplateUsage.NotUnderstood</a> template so that there are two patterns for how to respond to unknown text.  <div class="fragment"><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.NotUnderstood, <span class="stringliteral">&quot;I do not understand \&quot;{0}\&quot;.&quot;</span>, <span class="stringliteral">&quot;Try again, I don&#39;t get \&quot;{0}\&quot;.&quot;</span>)]</div><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.EnumSelectOne, <span class="stringliteral">&quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;</span>)]</div><div class="line">    <span class="comment">// [Template(TemplateUsage.EnumSelectOne, &quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;, ChoiceStyle = ChoiceStyleOptions.PerLine)]</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>SandwichOrder</div></div><!-- fragment --> Now when the user types something that is not understood, one of the two patterns will be randomly selected like this: </p><div class="fragment"><div class="line">What size of sandwich <span class="keywordflow">do</span> you want? (1. Six Inch, 2. Foot Long)</div><div class="line">&gt; two feet</div><div class="line">I <span class="keywordflow">do</span> not understand <span class="stringliteral">&quot;two feet&quot;</span>.</div><div class="line">&gt; two feet</div><div class="line">Try again, I don<span class="stringliteral">&#39;t get &quot;two feet&quot;</span></div><div class="line"><span class="stringliteral">&gt; </span></div></div><!-- fragment --><p>One of the things you can override are the terms used to match user input to a field or a value in a field. When matching user input, terms are used to identify possible meanings for what was typed.</p>
<p>By default, terms are generated by taking the field or value name and following these steps:</p><ul>
<li>Break on case changes and _.</li>
<li>Generate each n-gram up to a maximum length.</li>
<li>Add s? to the end to support plurals. For example, the value AngusBeefAndGarlicPizza would generate: 'angus?', 'beefs?', 'garlics?', 'pizzas?', 'angus? beefs?', 'garlics? pizzas?' and 'angus beef and garlic pizza'. The word "rotisserie" is one that is highly likely to be misspelled so here we have used a regular expression to make it more likely we will match what the user types. Because we specify Terms.MaxPhrase, Language.GenerateTerms will also generate variations for us.</li>
</ul>
 <div class="fragment"><div class="line">        [Terms(<span class="stringliteral">@&quot;rotis\w* style chicken&quot;</span>, MaxPhrase = 3)]</div><div class="line">        RotisserieStyleChicken, SpicyItalian, SteakAndCheese, SweetOnionTeriyaki, Tuna,</div></div><!-- fragment --></p>
<p>Given the terms now we can match input like this. </p><div class="fragment"><div class="line">What kind of sandwich would you like?</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Oven Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; rotissary checkin</div><div class="line">For sandwich I understood Rotisserie Style Chicken. <span class="stringliteral">&quot;checkin&quot;</span> is not an option.</div></div><!-- fragment --><p> Attributes can also be used to validate values. For example <a class="el" href="df/d31/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_numeric_attribute.html">Numeric</a> can be used to restrict the range of allowed numbers. In the below Rating must be a number between 1 and 5.  <div class="fragment"><div class="line">        [Numeric(1, 5)]</div><div class="line">        [Optional]</div><div class="line">        [Describe(<span class="stringliteral">&quot;your experience today&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">double</span>? Rating;</div></div><!-- fragment --></p>
<p>Similarly <a class="el" href="da/d2b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_pattern_attribute.html">Pattern</a> can be used to specify a regular expression to validate a string field like PhoneNumber.  <div class="fragment"><div class="line">        [Pattern(<span class="stringliteral">@&quot;(\(\d{3}\))?\s*\d{3}(-|\s*)\d{4}&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> PhoneNumber;</div></div><!-- fragment --></p>
<h2><a class="anchor" id="logic"></a>
Adding Business Logic</h2>
<p>Sometimes there are complex interdependencies between fields or you need to add logic to setting or getting a value. A validation function allows manipulating the state and also returns a <a class="el" href="d4/d7b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_validate_result.html" title="Encapsulates the result of a ValidateAsyncDelegate&lt;T&gt; ">ValidateResult</a> which can:</p><ul>
<li>Return a feedback string describing why a value is not valid.</li>
<li>Return a transformed value.</li>
<li>Return a set of choices for clarifying a value.</li>
</ul>
<p>Here we want to add support for including all toppings except some of them. To do this we complement the list if the Everything enum value is included:  <div class="fragment"><div class="line">                        .Field(nameof(Toppings),</div><div class="line">                            validate: async (state, value) =&gt;</div><div class="line">                            {</div><div class="line">                                var values = ((List&lt;object&gt;)value).OfType&lt;ToppingOptions&gt;();</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = values };</div><div class="line">                                <span class="keywordflow">if</span> (values != null &amp;&amp; values.Contains(ToppingOptions.Everything))</div><div class="line">                                {</div><div class="line">                                    result.Value = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                                    where topping != ToppingOptions.Everything &amp;&amp; !values.Contains(topping)</div><div class="line">                                                    select topping).ToList();</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div></div><!-- fragment --></p>
<p>In addition to the processing we also need to add some terms to match expressions like "everything" and "not".  <div class="fragment"><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ToppingOptions</div><div class="line">    {</div><div class="line">        <span class="comment">// This starts at 1 because 0 is the &quot;no value&quot; value</span></div><div class="line">        [Terms(<span class="stringliteral">&quot;except&quot;</span>, <span class="stringliteral">&quot;but&quot;</span>, <span class="stringliteral">&quot;not&quot;</span>, <span class="stringliteral">&quot;no&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;everything&quot;</span>)]</div><div class="line">        Everything = 1,</div></div><!-- fragment --></p>
<p>Here is what the interaction with toppings looks like: </p><div class="fragment"><div class="line">Please select one or more toppings (current choice: No Preference)</div><div class="line"> 1. Everything</div><div class="line"> 2. Avocado</div><div class="line"> 3. Banana Peppers</div><div class="line"> 4. Cucumbers</div><div class="line"> 5. Green Bell Peppers</div><div class="line"> 6. Jalapenos</div><div class="line"> 7. Lettuce</div><div class="line"> 8. Olives</div><div class="line"> 9. Pickles</div><div class="line"> 10. Red Onion</div><div class="line"> 11. Spinach</div><div class="line"> 12. Tomatoes</div><div class="line">&gt; everything but jalapenos</div><div class="line">For sandwich toppings you have selected Avocado, Banana Peppers, Cucumbers, Green Bell Peppers, Lettuce, Olives, Pickles, Red Onion, Spinach, and Tomatoes.</div></div><!-- fragment --><h2><a class="anchor" id="controlFlow"></a>
Using the Form Builder</h2>
<p>So far we have improved your dialog via attributes and business logic. There is another way to improve your dialog and that is through the <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a>. The <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a> allows more fine-grained control over the steps in your conversation and lets you put in messages and more friendly confirmations. By default the steps specified in the builder are executed in order. (Steps might be skipped if there is already a value, or if there is explicit navigation.) Here is a more complex usage of <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a>:  <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildForm()</div><div class="line">        {</div><div class="line">            OnCompletionAsyncDelegate&lt;SandwichOrder&gt; processOrder = async (context, state) =&gt;</div><div class="line">            {</div><div class="line">                await context.PostAsync(<span class="stringliteral">&quot;We are currently processing your sandwich. We will message you the status.&quot;</span>);</div><div class="line">            };</div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                        .Field(nameof(Sandwich))</div><div class="line">                        .Field(nameof(Length))</div><div class="line">                        .Field(nameof(Bread))</div><div class="line">                        .Field(nameof(Cheese))</div><div class="line">                        .Field(nameof(Toppings),</div><div class="line">                            validate: async (state, value) =&gt;</div><div class="line">                            {</div><div class="line">                                var values = ((List&lt;object&gt;)value).OfType&lt;ToppingOptions&gt;();</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = values };</div><div class="line">                                <span class="keywordflow">if</span> (values != null &amp;&amp; values.Contains(ToppingOptions.Everything))</div><div class="line">                                {</div><div class="line">                                    result.Value = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                                    where topping != ToppingOptions.Everything &amp;&amp; !values.Contains(topping)</div><div class="line">                                                    select topping).ToList();</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sauces))</div><div class="line">                        .Field(<span class="keyword">new</span> FieldReflector&lt;SandwichOrder&gt;(nameof(Specials))</div><div class="line">                            .SetType(null)</div><div class="line">                            .SetActive((state) =&gt; state.Length == LengthOptions.FootLong)</div><div class="line">                            .SetDefine(async (state, field) =&gt;</div><div class="line">                            {</div><div class="line">                                field</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;Free cookie&quot;</span>)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;free cookie&quot;</span>)</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;Free large drink&quot;</span>)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;free drink&quot;</span>);</div><div class="line">                                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">                            }))</div><div class="line">                        .Confirm(async (state) =&gt;</div><div class="line">                        {</div><div class="line">                            var cost = 0.0;</div><div class="line">                            <span class="keywordflow">switch</span> (state.Length)</div><div class="line">                            {</div><div class="line">                                case LengthOptions.SixInch: cost = 5.0; break;</div><div class="line">                                case LengthOptions.FootLong: cost = 6.50; break;</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">return</span> <span class="keyword">new</span> PromptAttribute($<span class="stringliteral">&quot;Total for your sandwich is {cost:C2} is that ok?&quot;</span>);</div><div class="line">                        })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryAddress),</div><div class="line">                            validate: async (state, response) =&gt;</div><div class="line">                            {</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = response };</div><div class="line">                                var address = (response as string).Trim();</div><div class="line">                                <span class="keywordflow">if</span> (address.Length &gt; 0 &amp;&amp; (address[0] &lt; <span class="charliteral">&#39;0&#39;</span> || address[0] &gt; <span class="charliteral">&#39;9&#39;</span>))</div><div class="line">                                {</div><div class="line">                                    result.Feedback = <span class="stringliteral">&quot;Address must start with a number.&quot;</span>;</div><div class="line">                                    result.IsValid = <span class="keyword">false</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryTime), <span class="stringliteral">&quot;What time do you want your sandwich delivered? {||}&quot;</span>)</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a70d9be9b139893aa6c69b5e77e614311">Confirm</a>(<span class="stringliteral">&quot;Do you want to order your {Length} {Sandwich} on {Bread} {&amp;Bread} with {[{Cheese} {Toppings} {Sauces}]} to be sent to {DeliveryAddress} {?at {DeliveryTime:t}}?&quot;</span>)</div><div class="line">                        .AddRemainingFields()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Thanks for ordering a sandwich!&quot;</span>)</div><div class="line">                        .OnCompletion(processOrder)</div><div class="line">                        .Build();</div><div class="line">        }</div></div><!-- fragment --></p>
<p>This looks complex, but that is because of the addition of advanced features like validation and dynamically defined fields. (See <a class="el" href="forms.html#dynamicFields">Dynamically Defined Fields, Confirmations and Messages</a> for more information.) The main structure is all about defining the default step order. Here are the steps:</p><ul>
<li>Show the welcome message.</li>
<li>Fill in SandwichOrder.Sandwich</li>
<li>Fill in SandwichOrder.Length</li>
<li>Fill in SandwichOrder.Bread</li>
<li>Fill in SandwichOrder.Cheese</li>
<li>Fill in SandwichOrder.Toppings and transform the value by complementing the list if it includes everything.</li>
<li>Show a message confirming the selected toppings.</li>
<li>Fill in SandwichOrder.Sauces</li>
<li>Dynamically defined field for SandwichOrder.Specials. (See <a class="el" href="forms.html#dynamicFields">Dynamically Defined Fields, Confirmations and Messages</a> for more information.)</li>
<li>Dynamically defined confirmation for the cost</li>
<li>Fill in SandwichOrder.DeliveryAddress and verify the resulting string. If it does not start with a number we return a message.</li>
<li>Fill in SandwichOrder.DeliveryTime with a custom prompt.</li>
<li>Confirm the order.</li>
<li>Add any remaining fields in the order they are defined in your class. (If this was left out, those steps to fill in those fields would not be included.)</li>
<li>Show a final thank you message.</li>
<li>Define an OnCompletionAsync handler to process the order.</li>
</ul>
<p>In the SandwichOrder.DeliveryTime prompt and the confirmation message you can see an instance of the <a class="el" href="forms.html#patterns">Pattern Language</a> where pattern elements like {Length} are filled in from your C# class before the string is shown to the user.</p>
<h2><a class="anchor" id="dynamicFields"></a>
Dynamically Defined Fields, Confirmations and Messages</h2>
<p><a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a> also allows you to do other more advanced things like dynamically switch on and off parts of your form based on the state of your object or dynamically define fields rather than drive them off a C# class.</p>
<p>In order to define a dynamic field, you can implement <a class="el" href="d5/d09/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_i_field.html" title="Interface for all the information about a specific field. ">Advanced.IField</a> yourself, but it is easier to make use of the <a class="el" href="d0/db3/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field_reflector.html" title="Fill in field information through reflection.">Advanced.FieldReflector</a> class. Imagine we would like to create some specials for free drinks and cookies but only for foot-long sandwiches. The first step for using <a class="el" href="d0/db3/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field_reflector.html" title="Fill in field information through reflection.">Advanced.FieldReflector</a> is to define the underlying field that will contain your dynamic value, like this:  <div class="fragment"><div class="line">        [Optional]</div><div class="line">        [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.NoPreference, <span class="stringliteral">&quot;None&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> Specials;</div></div><!-- fragment --></p>
<p>We can apply normal attributes to this field like <a class="el" href="d7/d6f/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_optional_attribute.html">Optional</a> to mark the field as allowing a no preference choice and by changing the template value for <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313a9c66f2227b4dc7054e34ea7bb3d1e010" title="How to show no preference in an optional field. ">TemplateUsage.NoPreference</a>.</p>
<p>Now we need to add the dynamic part to the <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a> like this:  <div class="fragment"><div class="line">                        .Field(<span class="keyword">new</span> FieldReflector&lt;SandwichOrder&gt;(nameof(Specials))</div><div class="line">                            .SetType(null)</div><div class="line">                            .SetActive((state) =&gt; state.Length == LengthOptions.FootLong)</div><div class="line">                            .SetDefine(async (state, field) =&gt;</div><div class="line">                            {</div><div class="line">                                field</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;Free cookie&quot;</span>)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;free cookie&quot;</span>)</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;Free large drink&quot;</span>)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;free drink&quot;</span>);</div><div class="line">                                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">                            }))</div></div><!-- fragment --></p>
<p>There are a couple of pieces here:</p><ul>
<li><a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html#a84d27b92be458b51a367c732e19a1fc2" title="Sets the type of the underlying field state. ">Advanced.Field.SetType</a> sets the type of the field&ndash;in this case null which means enumeration.</li>
<li><a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html#a048ce0f4bd1841ad37f3ed5f6e2df933" title="Define a delegate for checking state to see if field applies. ">Advanced.Field.SetActive</a> provides a delegate that enables the field only when the length is a foot long.</li>
<li><a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html#a28233c49a6abf58c2397bd397151278a" title="Define a delegate for dynamically defining field. ">Advanced.Field.SetDefine</a> provides an async delegate for defining the field. The delegate is passed the current state object and also the <a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html" title="Base class with declarative implementation of IField. ">Advanced.Field</a> that is being dynamically defined. The delegate uses the fluent methods found on the field to dynamically define values. In this case we define values as strings and supply the descriptions and terms for the value.</li>
</ul>
<p>Messages and confirmations can also be defined dynamically. Messages and confirmations only run when the prior steps are inactive or are completed. This is a confirmation that computes the cost of the sandwich:  <div class="fragment"><div class="line">                        .Confirm(async (state) =&gt;</div><div class="line">                        {</div><div class="line">                            var cost = 0.0;</div><div class="line">                            <span class="keywordflow">switch</span> (state.Length)</div><div class="line">                            {</div><div class="line">                                case LengthOptions.SixInch: cost = 5.0; break;</div><div class="line">                                case LengthOptions.FootLong: cost = 6.50; break;</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">return</span> <span class="keyword">new</span> PromptAttribute($<span class="stringliteral">&quot;Total for your sandwich is {cost:C2} is that ok?&quot;</span>);</div><div class="line">                        })</div></div><!-- fragment --></p>
<p>It is also possible to create a FormFlow experience without any C# class at all. The easiest way to do that is to derive a class from <a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html" title="Base class with declarative implementation of IField. ">Advanced.Field</a> and implement the <a class="el" href="d0/dab/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_i_field_state.html" title="Interface that defines basic access to a field. ">Advanced.IFieldState</a> methods to get and set values and unknown values.</p>
<h2><a class="anchor" id="localizingSection"></a>
Localization</h2>
<p>Once you have a great bot working in a single language, you might want to enable it in other languages. The localization language is determined by the current thread's <a href="https://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture(v=vs.110).aspx">CurrentUICulture</a> and <a href="https://msdn.microsoft.com/en-us/library/system.threading.thread.currentculture(v=vs.110).aspx">CurrentCulture</a>. By default the culture comes from the Language field of the current message, but you can change that if you wish. Depending on your bot, there can be up to 3 different sources of localized information including:</p><ul>
<li>The built-in localization for PromptDialog and FormFlow.</li>
<li>A resource file generated from the static strings found in your form.</li>
<li>A resource file you create with strings for dynamically computed fields, messages or confirmations.</li>
</ul>
<p>The static strings in a form include strings that are generated from the information in your C# class and from the strings you supply as prompts, templates, messages or confirmations. It does not include strings generated from built-in templates since those are already localized. Since many strings are automatically generated, it is not easy to use normal C# resource strings directly. For this reason we have provided the code to easily extract all of the static strings in a form by either:</p><ol type="1">
<li>Call IFormBuilder.SaveResource on your form to save a .resx file.</li>
<li>Use the supplied <code>rview</code> tool included in the NuGet package to generate a resource file from your .dll or .exe by specifying the assembly containing your static form building method and the path to that method. For example, the resource file Microsoft.Bot.Sample.AnnotatedSandwichBot.SandwichOrder.resx was generated by calling: <div class="fragment"><div class="line">rview -g <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.Sample.AnnotatedSandwichBot.dll <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.Sample.AnnotatedSandwichBot.SandwichOrder.BuildForm</div></div><!-- fragment --> Here for example are a few lines from the automatically generated .resx file:  <div class="fragment"><div class="line">  &lt;data name=<span class="stringliteral">&quot;Specials_description;VALUE&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;Specials&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div><div class="line">  &lt;data name=<span class="stringliteral">&quot;DeliveryAddress_description;VALUE&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;Delivery Address&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div><div class="line">  &lt;data name=<span class="stringliteral">&quot;DeliveryTime_description;VALUE&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;Delivery Time&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div><div class="line">  &lt;data name=<span class="stringliteral">&quot;PhoneNumber_description;VALUE&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;Phone Number&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div><div class="line">  &lt;data name=<span class="stringliteral">&quot;Rating_description;VALUE&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;your experience today&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div><div class="line">  &lt;data name=<span class="stringliteral">&quot;message0;LIST&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;Welcome to the sandwich order bot!&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div><div class="line">  &lt;data name=<span class="stringliteral">&quot;Sandwich_terms;LIST&quot;</span> xml:space=<span class="stringliteral">&quot;preserve&quot;</span>&gt;</div><div class="line">    &lt;value&gt;sandwichs?&lt;/value&gt;</div><div class="line">  &lt;/data&gt;</div></div><!-- fragment --></li>
</ol>
<p>In order to make use of a generated resource file, add it to your project and then set the neutral language by:</p><ol type="1">
<li>Right-click on your project and select the 'Application' tab.</li>
<li>Click on the 'Assembly Information' button.</li>
<li>Select the language you developed your bot in from the <code>Neutral Language</code> drop down.</li>
</ol>
<p>With these changes, when your form is created the <a class="el" href="d4/d1c/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_i_form_builder.html#aff9c6f19d725d19c23904d2e44c8daed" title="Build the form based on the methods called on the builder. ">IFormBuilder.Build</a> method will automatically look for resources that contain your form type name and use them to localize all of the static strings in your form.</p>
<p>Dynamic fields defined using <a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html#a28233c49a6abf58c2397bd397151278a" title="Define a delegate for dynamically defining field. ">Advanced.Field.SetDefine</a> cannot be localized since the strings in them are used to dynamically construct values when actually filling out a form. To localize these you can make use of the normal C# localization where a C# class for string resources is automatically generated for you.</p>
<p>Once you have the resource files added to your project you need to localize them. The easiest way to do this to make use of the Multilingual App Toolkit <a href="https://developer.microsoft.com/en-us/windows/develop/multilingual-app-toolkit">MAT</a>. We use that for our own localizations. (And would love if people want to contribute new or improved ones.) If you install <a href="https://developer.microsoft.com/en-us/windows/develop/multilingual-app-toolkit">MAT</a> you can enable it on a project by:</p><ol type="1">
<li>Select your project in the Visual Studio Solution Explorer</li>
<li>Click on <code>Tools-&gt;Multilingual App Toolkit-&gt;Enable selection</code> to enable your project.</li>
<li>Right click on the project and select <code>Multilingual App Toolkit-&gt;Add Translations</code> to select the translations. This will create industry standard <a href="https://en.wikipedia.org/wiki/XLIFF">XLF</a> files which you can then automatically or manually translate.</li>
</ol>
<p>Putting this all together, here is what the Annotated Sandwich Bot form builder would look like where the dynamic C# resources are found in DynamicSandwich:  <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildLocalizedForm()</div><div class="line">        {</div><div class="line">            var culture = Thread.CurrentThread.CurrentUICulture;</div><div class="line">            IForm&lt;SandwichOrder&gt; form;</div><div class="line">            <span class="keywordflow">if</span> (!_forms.TryGetValue(culture, out form))</div><div class="line">            {</div><div class="line">                OnCompletionAsyncDelegate&lt;SandwichOrder&gt; processOrder = async (context, state) =&gt;</div><div class="line">                                {</div><div class="line">                                    await context.PostAsync(DynamicSandwich.Processing);</div><div class="line">                                };</div><div class="line">                <span class="comment">// Form builder uses the thread culture to automatically switch framework strings</span></div><div class="line">                <span class="comment">// and also your static strings as well.  Dynamically defined fields must do their own localization.</span></div><div class="line">                var builder = <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                        .Field(nameof(Sandwich))</div><div class="line">                        .Field(nameof(Length))</div><div class="line">                        .Field(nameof(Bread))</div><div class="line">                        .Field(nameof(Cheese))</div><div class="line">                        .Field(nameof(Toppings),</div><div class="line">                            validate: async (state, value) =&gt;</div><div class="line">                            {</div><div class="line">                                var values = ((List&lt;object&gt;)value).OfType&lt;ToppingOptions&gt;();</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = values };</div><div class="line">                                <span class="keywordflow">if</span> (values != null &amp;&amp; values.Contains(ToppingOptions.Everything))</div><div class="line">                                {</div><div class="line">                                    result.Value = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                                    where topping != ToppingOptions.Everything &amp;&amp; !values.Contains(topping)</div><div class="line">                                                    select topping).ToList();</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sauces))</div><div class="line">                        .Field(<span class="keyword">new</span> FieldReflector&lt;SandwichOrder&gt;(nameof(Specials))</div><div class="line">                            .SetType(null)</div><div class="line">                            .SetActive((state) =&gt; state.Length == LengthOptions.FootLong)</div><div class="line">                            .SetDefine(async (state, field) =&gt;</div><div class="line">                                {</div><div class="line">                                    field</div><div class="line">                                        .AddDescription(<span class="stringliteral">&quot;cookie&quot;</span>, DynamicSandwich.FreeCookie)</div><div class="line">                                        .AddTerms(<span class="stringliteral">&quot;cookie&quot;</span>, Language.GenerateTerms(DynamicSandwich.FreeCookie, 2))</div><div class="line">                                        .AddDescription(<span class="stringliteral">&quot;drink&quot;</span>, DynamicSandwich.FreeDrink)</div><div class="line">                                        .AddTerms(<span class="stringliteral">&quot;drink&quot;</span>, Language.GenerateTerms(DynamicSandwich.FreeDrink, 2));</div><div class="line">                                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">                                }))</div><div class="line">                        .Confirm(async (state) =&gt;</div><div class="line">                            {</div><div class="line">                                var cost = 0.0;</div><div class="line">                                <span class="keywordflow">switch</span> (state.Length)</div><div class="line">                                {</div><div class="line">                                    case LengthOptions.SixInch: cost = 5.0; break;</div><div class="line">                                    case LengthOptions.FootLong: cost = 6.50; break;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> <span class="keyword">new</span> PromptAttribute(<span class="keywordtype">string</span>.Format(DynamicSandwich.Cost, cost) + <span class="stringliteral">&quot;{||}&quot;</span>);</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryAddress),</div><div class="line">                            validate: async (state, response) =&gt;</div><div class="line">                            {</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = response };</div><div class="line">                                var address = (response as string).Trim();</div><div class="line">                                <span class="keywordflow">if</span> (address.Length &gt; 0 &amp;&amp; address[0] &lt; <span class="charliteral">&#39;0&#39;</span> || address[0] &gt; <span class="charliteral">&#39;9&#39;</span>)</div><div class="line">                                {</div><div class="line">                                    result.Feedback = DynamicSandwich.BadAddress;</div><div class="line">                                    result.IsValid = <span class="keyword">false</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryTime), <span class="stringliteral">&quot;What time do you want your sandwich delivered? {||}&quot;</span>)</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a70d9be9b139893aa6c69b5e77e614311">Confirm</a>(<span class="stringliteral">&quot;Do you want to order your {Length} {Sandwich} on {Bread} {&amp;Bread} with {[{Cheese} {Toppings} {Sauces}]} to be sent to {DeliveryAddress} {?at {DeliveryTime:t}}?&quot;</span>)</div><div class="line">                        .AddRemainingFields()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Thanks for ordering a sandwich!&quot;</span>)</div><div class="line">                        .OnCompletion(processOrder);</div><div class="line">                builder.Configuration.DefaultPrompt.ChoiceStyle = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ac6396117e96818e92b4892d316e326d9">ChoiceStyleOptions</a>.Auto;</div><div class="line">                form = builder.Build();</div><div class="line">                _forms[culture] = form;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">return</span> form;</div><div class="line">        }</div><div class="line">    };</div></div><!-- fragment --></p>
<p>And here is a snippet of a dialog generated by that form when the CurrentUICulture is French. </p><div class="fragment"><div class="line">Bienvenue sur le bot d<span class="stringliteral">&#39;ordre &quot;sandwich&quot; !</span></div><div class="line"><span class="stringliteral">Quel genre de &quot;sandwich&quot; vous souhaitez sur votre &quot;sandwich&quot;?</span></div><div class="line"><span class="stringliteral"> 1. BLT</span></div><div class="line"><span class="stringliteral"> 2. Jambon Forêt Noire</span></div><div class="line"><span class="stringliteral"> 3. Poulet Buffalo</span></div><div class="line"><span class="stringliteral"> 4. Faire fondre le poulet et Bacon Ranch</span></div><div class="line"><span class="stringliteral"> 5. Combo de coupe à froid</span></div><div class="line"><span class="stringliteral"> 6. Boulette de viande Marinara</span></div><div class="line"><span class="stringliteral"> 7. Poulet rôti au four</span></div><div class="line"><span class="stringliteral"> 8. Rôti de boeuf</span></div><div class="line"><span class="stringliteral"> 9. Rotisserie poulet</span></div><div class="line"><span class="stringliteral"> 10. Italienne piquante</span></div><div class="line"><span class="stringliteral"> 11. Bifteck et fromage</span></div><div class="line"><span class="stringliteral"> 12. Oignon doux Teriyaki</span></div><div class="line"><span class="stringliteral"> 13. Thon</span></div><div class="line"><span class="stringliteral"> 14. Poitrine de dinde</span></div><div class="line"><span class="stringliteral"> 15. Veggie</span></div><div class="line"><span class="stringliteral">&gt; 2</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral">Quel genre de longueur vous souhaitez sur votre &quot;sandwich&quot;?</span></div><div class="line"><span class="stringliteral"> 1. Six pouces</span></div><div class="line"><span class="stringliteral"> 2. Pied Long</span></div><div class="line"><span class="stringliteral">&gt; ?</span></div><div class="line"><span class="stringliteral">* Vous renseignez le champ longueur.Réponses possibles:</span></div><div class="line"><span class="stringliteral">* Vous pouvez saisir un numéro 1-2 ou des mots de la description. (Six pouces, ou Pied Long)</span></div><div class="line"><span class="stringliteral">* Retourner à la question précédente.</span></div><div class="line"><span class="stringliteral">* Assistance: Montrez les réponses possibles.</span></div><div class="line"><span class="stringliteral">* Abandonner: Abandonner sans finir</span></div><div class="line"><span class="stringliteral">* Recommencer remplir le formulaire. (Vos réponses précédentes sont enregistrées.)</span></div><div class="line"><span class="stringliteral">* Statut: Montrer le progrès en remplissant le formulaire jusqu&#39;</span>à présent.</div><div class="line">* Vous pouvez passer à un autre champ en entrant son nom. (<span class="stringliteral">&quot;Sandwich&quot;</span>, Longueur, Pain, Fromage, Nappages, Sauces, Adresse de remise, Délai de livraison, ou votre expérience aujourd<span class="stringliteral">&#39;hui).</span></div><div class="line"><span class="stringliteral">Quel genre de longueur vous souhaitez sur votre &quot;sandwich&quot;?</span></div><div class="line"><span class="stringliteral"> 1. Six pouces</span></div><div class="line"><span class="stringliteral"> 2. Pied Long</span></div><div class="line"><span class="stringliteral">&gt; 1</span></div><div class="line"><span class="stringliteral"></span></div><div class="line"><span class="stringliteral">Quel genre de pain vous souhaitez sur votre &quot;sandwich&quot;?</span></div><div class="line"><span class="stringliteral"> 1. Neuf grains de blé</span></div><div class="line"><span class="stringliteral"> 2. Neuf grains miel avoine</span></div><div class="line"><span class="stringliteral"> 3. Italien</span></div><div class="line"><span class="stringliteral"> 4. Fromage et herbes italiennes</span></div><div class="line"><span class="stringliteral"> 5. Pain plat</span></div><div class="line"><span class="stringliteral">&gt; neuf</span></div><div class="line"><span class="stringliteral">Par pain &quot;neuf&quot; vouliez-vous dire (1. Neuf grains miel avoine, ou 2. Neuf grains de blé)</span></div><div class="line"><span class="stringliteral">...</span></div></div><!-- fragment --><h2><a class="anchor" id="jsonForms"></a>
JSON Schema FormFlow</h2>
<p>In the examples we have seen so far, forms have been defined by a C# class. An alternative way to define your forms is to use <a href="http://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_Linq_JObject.htm">JObject</a> as your state and define the schema through <a href="http://json-schema.org/documentation.html">JSON Schema</a>. The schema provides a way of describing the fields that make up your <a href="http://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_Linq_JObject.htm">JObject</a> and also allow annotations similar to C# attributes for controlling prompts, templates and terms. The advantage of using a <a href="http://www.newtonsoft.com/json/help/html/T_Newtonsoft_Json_Linq_JObject.htm">JObject</a> for your state is that the form definition is entirely driven by data rather than the static definition of your type in C#.</p>
<p>In order to utilize this feature you need to ensure that you add the NuGet project <a href="https://www.nuget.org/packages/Microsoft.Bot.Builder.FormFlow.Json/">Microsoft.Bot.Builder.FormFlow.Json</a> to your project. This defines the new namespace Microsoft.Bot.Builder.FormFlow.Json that contains the code to allows using JSON Schema for FormFlow.</p>
<p>FormFlow makes use of a number of standard <a href="http://json-schema.org/latest/json-schema-validation.html">JSON Schema</a> keywords include:</p><ul>
<li><code>type</code> &ndash; Defines the fields type.</li>
<li><code>enum</code> &ndash; Defines the possible field values.</li>
<li><code>minimum</code> &ndash; Defines the minimum allowed value as described in <a class="el" href="df/d31/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_numeric_attribute.html" title="Provide limits on the possible values in a numeric field or property. ">NumericAttribute</a>.</li>
<li><code>maximum</code> &ndash; Defines the maximum allowed value as described in <a class="el" href="df/d31/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_numeric_attribute.html" title="Provide limits on the possible values in a numeric field or property. ">NumericAttribute</a>.</li>
<li><code>required</code> &ndash; Defines what fields are required.</li>
<li><code>pattern</code> &ndash; For string fields will be used to validate the entered pattern as described in <a class="el" href="da/d2b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_pattern_attribute.html" title="Provide a regular expression to validate a string field. ">PatternAttribute</a>.</li>
</ul>
<p>Templates and prompts use the same vocabulary as <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html" title="Define a template for generating strings. ">TemplateAttribute</a> and <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html" title="Define the prompt template used when asking about a field. ">PromptAttribute</a>. The property names are the same and the values are the same as those in the underlying C# enumeration. For example to define a template to override the <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313aca296fd71c8deadb1bccdad8e097bc50" title="Response when an input is not understood. ">TemplateUsage.NotUnderstood</a> template and specify a TemplateBaseAttribute.ChoiceStyle you would put this in your schema: </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;Templates&quot;</span>:{ <span class="stringliteral">&quot;NotUnderstood&quot;</span>: { Patterns: [<span class="stringliteral">&quot;I don&#39;t get it&quot;</span>], <span class="stringliteral">&quot;ChoiceStyle&quot;</span>:<span class="stringliteral">&quot;Auto&quot;</span>}}</div></div><!-- fragment --><p>Extensions defined at the root fo the schema</p><ul>
<li><code>OnCompletion: script</code> &ndash; C# script with arguments (IDialogContext context, JObject state) for completing form.</li>
<li><code>References: [assemblyReference, ...]</code> &ndash; Define references to include in scripts. Paths should be absolute, or relative to the current directory. By default Microsoft.Bot.Builder.dll is included.</li>
<li><code>Imports: [import, ...]</code> &ndash; Define imports to include in scripts with usings. By default these namespaces are included: <a class="el" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html" title="Root namespace for the Microsoft Bot Builder SDK.">Microsoft.Bot.Builder</a>, <a class="el" href="d1/d6a/namespace_microsoft_1_1_bot_1_1_builder_1_1_dialogs.html" title="Core namespace for Dialogs and associated infrastructure.">Microsoft.Bot.Builder.Dialogs</a>, <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html" title="Core namespace for FormFlow and associated infrastructure.">Microsoft.Bot.Builder.FormFlow</a>, <a class="el" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html" title="Namespace for FormFlow advanced building blocks.">Microsoft.Bot.Builder.FormFlow.Advanced</a>, System.Collections.Generic, System.Linq)</li>
</ul>
<p>Extensions defined at the root of a schema or as a peer of the "type" property.</p><ul>
<li><code>Templates:{TemplateUsage: { Patterns:[string, ...], &lt;args&gt; }, ...}</code> &ndash; Define templates.</li>
<li><code>Prompt: { Patterns:[string, ...] &lt;args&gt;}</code> &ndash; Define a prompt.</li>
</ul>
<p>Extensions that are found in a property description as peers to the "type" property of a JSON Schema.</p><ul>
<li><code>DateTime:bool</code> &ndash; Marks a field as being a DateTime field.</li>
<li><code>Describe:string|object</code> &ndash; Description of a field as described in <a class="el" href="dd/d38/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_describe_attribute.html" title="Attribute to override the default description of a field, property or enum value. ...">DescribeAttribute</a>.</li>
<li><code>Terms:[string,...]</code> &ndash; Regular expressions for matching a field value as described in <a class="el" href="d2/d27/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_terms_attribute.html" title="Attribute to override the default terms used to match a field, property or enum value to user input...">TermsAttribute</a>.</li>
<li><code>MaxPhrase:int</code> &ndash; This will run your terms through Language.GenerateTerms(string, int) to expand them.</li>
<li><code>Values:{ string: {Describe:string|object, Terms:[string, ...], MaxPhrase}, ...}</code> &ndash; The string must be found in the types "enum" and this allows you to override the automatically generated descriptions and terms. If MaxPhrase is specified the terms are passed through Language.GenerateTerms(string, int).</li>
<li><code>Active:script</code> &ndash; C# script with arguments (JObject state)-&gt;bool to test to see if field/message/confirm is active.</li>
<li><code>Validate:script</code> &ndash; C# script with arguments (JObject state, object value)-&gt;<a class="el" href="d4/d7b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_validate_result.html" title="Encapsulates the result of a ValidateAsyncDelegate&lt;T&gt; ">ValidateResult</a> for validating a field value.</li>
<li><code>Define:script</code> &ndash; C# script with arguments (JObject state, Field&lt;JObject&gt; field) for dynamically defining a field.</li>
<li><code>Next:script</code> &ndash; C# script with arguments (object value, JObject state) for determining the next step after filling in a field.</li>
<li><code>Before:[confirm|message, ...]</code> &ndash; Messages or confirmations before the containing field.</li>
<li><code>After:[confirm|message, ...]</code> &ndash; Messages or confirmations after the containing field.</li>
<li><code>{Confirm:script|[string, ...], ...templateArgs}</code> &ndash; With Before/After define a confirmation through either C# script with argument (JObject state) or through a set of patterns that will be randomly selected with optional template arguments.</li>
<li><code>{Message:script|[string, ...] ...templateArgs}</code> &ndash; With Before/After define a message through either C# script with argument (JObject state) or through a set of patterns that will be randomly selected with optional template arguments.</li>
<li><code>Dependencies</code>:[string, ...]` &ndash; Fields that this field, message or confirm depends on.</li>
</ul>
<p>Scripts can be any C# code you would find in a method body. You can add references through "References" and using through "Imports". Special global variables include:</p><ul>
<li><code>choice</code> &ndash; internal dispatch for script to execute.</li>
<li><code>state</code> &ndash; JObject form state bound for all scripts.</li>
<li><code>ifield</code> &ndash; <a class="el" href="d5/d09/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_i_field.html">IField&lt;JObject&gt;</a> to allow reasoning over the current field for all scripts except Message/Confirm prompt builders.</li>
<li><code>value</code> &ndash; object value to be validated for Validate.</li>
<li><code>field</code> &ndash; <a class="el" href="d2/d1b/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_field.html">Field&lt;JObject&gt;</a> to allow dynamically updating a field in Define.</li>
<li><code>context</code> &ndash; IDialogContext context to allow posting results in OnCompletion.</li>
</ul>
<p>Fields defined through this class have the same ability to extend or override the definitions programatically as any other field. They can also be localized in the same way.</p>
<p>The simplest way to define your form is to define everything including any C# code directly in your schema definition. Here for example is the <a href="http://json-schema.org/documentation.html">JSON Schema</a> that corresponds to the Annotated Sandwich Bot we have defined so far. </p><div class="fragment"><div class="line">{</div><div class="line">  &quot;References&quot;: [ &quot;Microsoft.Bot.Sample.AnnotatedSandwichBot.dll&quot; ],</div><div class="line">  &quot;Imports&quot;: [ &quot;Microsoft.Bot.Sample.AnnotatedSandwichBot.Resource&quot; ],</div><div class="line">  &quot;type&quot;: &quot;object&quot;,</div><div class="line">  &quot;required&quot;: [</div><div class="line">    &quot;Sandwich&quot;,</div><div class="line">    &quot;Length&quot;,</div><div class="line">    &quot;Ingredients&quot;,</div><div class="line">    &quot;DeliveryAddress&quot;</div><div class="line">  ],</div><div class="line">  &quot;Templates&quot;: {</div><div class="line">    &quot;NotUnderstood&quot;: {</div><div class="line">      &quot;Patterns&quot;: [ &quot;I do not understand \&quot;{0}\&quot;.&quot;, &quot;Try again, I don&#39;t get \&quot;{0}\&quot;.&quot; ]</div><div class="line">    },</div><div class="line">    &quot;EnumSelectOne&quot;: {</div><div class="line">      &quot;Patterns&quot;: [ &quot;What kind of {&amp;} would you like on your sandwich? {||}&quot; ],</div><div class="line">      &quot;ChoiceStyle&quot;: &quot;Auto&quot;</div><div class="line">    }</div><div class="line">  },</div><div class="line">  &quot;properties&quot;: {</div><div class="line">    &quot;Sandwich&quot;: {</div><div class="line">      &quot;Prompt&quot;: { &quot;Patterns&quot;: [ &quot;What kind of {&amp;} would you like? {||}&quot; ] },</div><div class="line">      &quot;Before&quot;: [ { &quot;Message&quot;: [ &quot;Welcome to the sandwich order bot!&quot; ] } ],</div><div class="line">      &quot;Describe&quot;: { &quot;Image&quot;: &quot;https://placeholdit.imgix.net/~text?txtsize=16&amp;txt=Sandwich&amp;w=125&amp;h=40&amp;txttrack=0&amp;txtclr=000&amp;txtfont=bold&quot; },</div><div class="line">      &quot;type&quot;: [</div><div class="line">        &quot;string&quot;,</div><div class="line">        &quot;null&quot;</div><div class="line">      ],</div><div class="line">      &quot;enum&quot;: [</div><div class="line">        &quot;BLT&quot;,</div><div class="line">        &quot;BlackForestHam&quot;,</div><div class="line">        &quot;BuffaloChicken&quot;,</div><div class="line">        &quot;ChickenAndBaconRanchMelt&quot;,</div><div class="line">        &quot;ColdCutCombo&quot;,</div><div class="line">        &quot;MeatballMarinara&quot;,</div><div class="line">        &quot;OvenRoastedChicken&quot;,</div><div class="line">        &quot;RoastBeef&quot;,</div><div class="line">        &quot;RotisserieStyleChicken&quot;,</div><div class="line">        &quot;SpicyItalian&quot;,</div><div class="line">        &quot;SteakAndCheese&quot;,</div><div class="line">        &quot;SweetOnionTeriyaki&quot;,</div><div class="line">        &quot;Tuna&quot;,</div><div class="line">        &quot;TurkeyBreast&quot;,</div><div class="line">        &quot;Veggie&quot;</div><div class="line">      ],</div><div class="line">      &quot;Values&quot;: {</div><div class="line">        &quot;RotisserieStyleChicken&quot;: {</div><div class="line">          &quot;Terms&quot;: [ &quot;rotis\\w* style chicken&quot; ],</div><div class="line">          &quot;MaxPhrase&quot;: 3</div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    &quot;Length&quot;: {</div><div class="line">      &quot;Prompt&quot;: {</div><div class="line">        &quot;Patterns&quot;: [ &quot;What size of sandwich do you want? {||}&quot; ]</div><div class="line">      },</div><div class="line">      &quot;type&quot;: [</div><div class="line">        &quot;string&quot;,</div><div class="line">        &quot;null&quot;</div><div class="line">      ],</div><div class="line">      &quot;enum&quot;: [</div><div class="line">        &quot;SixInch&quot;,</div><div class="line">        &quot;FootLong&quot;</div><div class="line">      ]</div><div class="line">    },</div><div class="line">    &quot;Ingredients&quot;: {</div><div class="line">      &quot;type&quot;: &quot;object&quot;,</div><div class="line">      &quot;required&quot;: [ &quot;Bread&quot; ],</div><div class="line">      &quot;properties&quot;: {</div><div class="line">        &quot;Bread&quot;: {</div><div class="line">          &quot;type&quot;: [</div><div class="line">            &quot;string&quot;,</div><div class="line">            &quot;null&quot;</div><div class="line">          ],</div><div class="line">          &quot;Describe&quot;: {</div><div class="line">            &quot;Title&quot;: &quot;Sandwich Bot&quot;,</div><div class="line">            &quot;SubTitle&quot;: &quot;Bread Picker&quot;</div><div class="line">          },</div><div class="line">          &quot;enum&quot;: [</div><div class="line">            &quot;NineGrainWheat&quot;,</div><div class="line">            &quot;NineGrainHoneyOat&quot;,</div><div class="line">            &quot;Italian&quot;,</div><div class="line">            &quot;ItalianHerbsAndCheese&quot;,</div><div class="line">            &quot;Flatbread&quot;</div><div class="line">          ]</div><div class="line">        },</div><div class="line">        &quot;Cheese&quot;: {</div><div class="line">          &quot;type&quot;: [</div><div class="line">            &quot;string&quot;,</div><div class="line">            &quot;null&quot;</div><div class="line">          ],</div><div class="line">          &quot;enum&quot;: [</div><div class="line">            &quot;American&quot;,</div><div class="line">            &quot;MontereyCheddar&quot;,</div><div class="line">            &quot;Pepperjack&quot;</div><div class="line">          ]</div><div class="line">        },</div><div class="line">        &quot;Toppings&quot;: {</div><div class="line">          &quot;type&quot;: &quot;array&quot;,</div><div class="line">          &quot;items&quot;: {</div><div class="line">            &quot;type&quot;: &quot;integer&quot;,</div><div class="line">            &quot;enum&quot;: [</div><div class="line">              &quot;Everything&quot;,</div><div class="line">              &quot;Avocado&quot;,</div><div class="line">              &quot;BananaPeppers&quot;,</div><div class="line">              &quot;Cucumbers&quot;,</div><div class="line">              &quot;GreenBellPeppers&quot;,</div><div class="line">              &quot;Jalapenos&quot;,</div><div class="line">              &quot;Lettuce&quot;,</div><div class="line">              &quot;Olives&quot;,</div><div class="line">              &quot;Pickles&quot;,</div><div class="line">              &quot;RedOnion&quot;,</div><div class="line">              &quot;Spinach&quot;,</div><div class="line">              &quot;Tomatoes&quot;</div><div class="line">            ],</div><div class="line">            &quot;Values&quot;: {</div><div class="line">              &quot;Everything&quot;: { &quot;Terms&quot;: [ &quot;except&quot;, &quot;but&quot;, &quot;not&quot;, &quot;no&quot;, &quot;all&quot;, &quot;everything&quot; ] }</div><div class="line">            }</div><div class="line">          },</div><div class="line">          &quot;Validate&quot;: &quot;var values = ((List&lt;object&gt;) value).OfType&lt;string&gt;(); var result = new ValidateResult {IsValid = true, Value = values} ; if (values != null &amp;&amp; values.Contains(\&quot;Everything\&quot;)) { result.Value = (from topping in new string[] {  \&quot;Avocado\&quot;, \&quot;BananaPeppers\&quot;, \&quot;Cucumbers\&quot;, \&quot;GreenBellPeppers\&quot;, \&quot;Jalapenos\&quot;, \&quot;Lettuce\&quot;, \&quot;Olives\&quot;, \&quot;Pickles\&quot;, \&quot;RedOnion\&quot;, \&quot;Spinach\&quot;, \&quot;Tomatoes\&quot;} where !values.Contains(topping) select topping).ToList();} return result;&quot;,</div><div class="line">          &quot;After&quot;: [ { &quot;Message&quot;: [ &quot;For sandwich toppings you have selected {Ingredients.Toppings}.&quot; ] } ]</div><div class="line">        },</div><div class="line">        &quot;Sauces&quot;: {</div><div class="line">          &quot;type&quot;: [</div><div class="line">            &quot;array&quot;,</div><div class="line">            &quot;null&quot;</div><div class="line">          ],</div><div class="line">          &quot;items&quot;: {</div><div class="line">            &quot;type&quot;: &quot;string&quot;,</div><div class="line">            &quot;enum&quot;: [</div><div class="line">              &quot;ChipotleSouthwest&quot;,</div><div class="line">              &quot;HoneyMustard&quot;,</div><div class="line">              &quot;LightMayonnaise&quot;,</div><div class="line">              &quot;RegularMayonnaise&quot;,</div><div class="line">              &quot;Mustard&quot;,</div><div class="line">              &quot;Oil&quot;,</div><div class="line">              &quot;Pepper&quot;,</div><div class="line">              &quot;Ranch&quot;,</div><div class="line">              &quot;SweetOnion&quot;,</div><div class="line">              &quot;Vinegar&quot;</div><div class="line">            ]</div><div class="line">          }</div><div class="line">        }</div><div class="line">      }</div><div class="line">    },</div><div class="line">    &quot;Specials&quot;: {</div><div class="line">      &quot;Templates&quot;: {</div><div class="line">        &quot;NoPreference&quot;: { &quot;Patterns&quot;: [ &quot;None&quot; ] }</div><div class="line">      },</div><div class="line">      &quot;type&quot;: [</div><div class="line">        &quot;string&quot;,</div><div class="line">        &quot;null&quot;</div><div class="line">      ],</div><div class="line">      &quot;Active&quot;: &quot;return (string) state[\&quot;Length\&quot;] == \&quot;FootLong\&quot;;&quot;,</div><div class="line">      &quot;Define&quot;: &quot;field.SetType(null).AddDescription(\&quot;cookie\&quot;, DynamicSandwich.FreeCookie).AddTerms(\&quot;cookie\&quot;, Language.GenerateTerms(DynamicSandwich.FreeCookie, 2)).AddDescription(\&quot;drink\&quot;, DynamicSandwich.FreeDrink).AddTerms(\&quot;drink\&quot;, Language.GenerateTerms(DynamicSandwich.FreeDrink, 2)); return true;&quot;,</div><div class="line">      &quot;After&quot;: [ { &quot;Confirm&quot;: &quot;var cost = 0.0; switch ((string) state[\&quot;Length\&quot;]) { case \&quot;SixInch\&quot;: cost = 5.0; break; case \&quot;FootLong\&quot;: cost=6.50; break;} return new PromptAttribute($\&quot;Total for your sandwich is {cost:C2} is that ok?\&quot;);&quot; } ]</div><div class="line">    },</div><div class="line">    &quot;DeliveryAddress&quot;: {</div><div class="line">      &quot;type&quot;: [</div><div class="line">        &quot;string&quot;,</div><div class="line">        &quot;null&quot;</div><div class="line">      ],</div><div class="line">      &quot;Validate&quot;: &quot;var result = new ValidateResult{ IsValid = true, Value = value}; var address = (value as string).Trim(); if (address.Length &gt; 0 &amp;&amp; (address[0] &lt; &#39;0&#39; || address[0] &gt; &#39;9&#39;)) {result.Feedback = DynamicSandwich.BadAddress; result.IsValid = false; } return result;&quot;</div><div class="line">    },</div><div class="line">    &quot;PhoneNumber&quot;: {</div><div class="line">      &quot;type&quot;: [ &quot;string&quot;, &quot;null&quot; ],</div><div class="line">      &quot;pattern&quot;: &quot;(\\(\\d{3}\\))?\\s*\\d{3}(-|\\s*)\\d{4}&quot;</div><div class="line">    },</div><div class="line">    &quot;DeliveryTime&quot;: {</div><div class="line">      &quot;Templates&quot;: {</div><div class="line">        &quot;StatusFormat&quot;: {</div><div class="line">          &quot;Patterns&quot;: [ &quot;{&amp;}: {:t}&quot; ],</div><div class="line">          &quot;FieldCase&quot;: &quot;None&quot;</div><div class="line">        }</div><div class="line">      },</div><div class="line">      &quot;DateTime&quot;: true,</div><div class="line">      &quot;type&quot;: [</div><div class="line">        &quot;string&quot;,</div><div class="line">        &quot;null&quot;</div><div class="line">      ],</div><div class="line">      &quot;After&quot;: [ { &quot;Confirm&quot;: [ &quot;Do you want to order your {Length} {Sandwich} on {Ingredients.Bread} {&amp;Ingredients.Bread} with {[{Ingredients.Cheese} {Ingredients.Toppings} {Ingredients.Sauces} to be sent to {DeliveryAddress} {?at {DeliveryTime}}?&quot; ] } ]</div><div class="line">    },</div><div class="line">    &quot;Rating&quot;: {</div><div class="line">      &quot;Describe&quot;: &quot;your experience today&quot;,</div><div class="line">      &quot;type&quot;: [</div><div class="line">        &quot;number&quot;,</div><div class="line">        &quot;null&quot;</div><div class="line">      ],</div><div class="line">      &quot;minimum&quot;: 1,</div><div class="line">      &quot;maximum&quot;: 5,</div><div class="line">      &quot;After&quot;: [ { &quot;Message&quot;: [ &quot;Thanks for ordering your sandwich!&quot; ] } ]</div><div class="line">    }</div><div class="line">  },</div><div class="line">  &quot;OnCompletion&quot;: &quot;await context.PostAsync(\&quot;We are currently processing your sandwich. We will message you the status.\&quot;);&quot;</div><div class="line">}</div></div><!-- fragment --><p>In order to make use of your <a href="http://json-schema.org/documentation.html">JSON Schema</a> you use FormBuilderJson which supports the same fluent interface as <a class="el" href="de/d9d/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_builder.html" title="Build a form by specifying messages, fields and confirmations via reflection or programatically.">FormBuilder</a>. Here is the code to make use of the <a href="http://json-schema.org/documentation.html">JSON Schema</a> above to define exactly the same functionality:  <div class="fragment"><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;JObject&gt; BuildJsonForm()</div><div class="line">        {</div><div class="line">            <span class="keyword">using</span> (var stream = Assembly.GetExecutingAssembly().GetManifestResourceStream(<span class="stringliteral">&quot;Microsoft.Bot.Sample.AnnotatedSandwichBot.AnnotatedSandwich.json&quot;</span>))</div><div class="line">            {</div><div class="line">                var schema = JObject.Parse(<span class="keyword">new</span> StreamReader(stream).ReadToEnd());</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilderJson(schema)</div><div class="line">                    .AddRemainingFields()</div><div class="line">                    .Build();</div><div class="line">            }</div></div><!-- fragment --></p>
<h2><a class="anchor" id="quitExceptions"></a>
Handling Quit and Exceptions</h2>
<p>When the user types 'quit' or there is an exception while filling in a form using <a class="el" href="db/de5/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_dialog.html" title="Form dialog to fill in your state. ">FormDialog</a> it is useful to be able to know what step the 'quit' or exception happened, the state of the form and and what steps were successfully completed. All of these are passed back through the FormCanceledException&lt;T&gt; class. Here is an example of how to catch the exception and send a message after either:</p><ul>
<li>Successfully processing the order.</li>
<li>When the user quit.</li>
<li>When there is an exception.  <div class="fragment"><div class="line">        <span class="keyword">internal</span> <span class="keyword">static</span> IDialog&lt;SandwichOrder&gt; MakeRootDialog()</div><div class="line">        {</div><div class="line">            <span class="keywordflow">return</span> Chain.From(() =&gt; FormDialog.FromForm(SandwichOrder.BuildLocalizedForm))</div><div class="line">                .Do(async (context, order) =&gt;</div><div class="line">                {</div><div class="line">                    <span class="keywordflow">try</span></div><div class="line">                    {</div><div class="line">                        var completed = await order;</div><div class="line">                        <span class="comment">// Actually process the sandwich order...</span></div><div class="line">                        await context.PostAsync(<span class="stringliteral">&quot;Processed your order!&quot;</span>);</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">catch</span> (FormCanceledException&lt;SandwichOrder&gt; e)</div><div class="line">                    {</div><div class="line">                        <span class="keywordtype">string</span> reply;</div><div class="line">                        <span class="keywordflow">if</span> (e.InnerException == null)</div><div class="line">                        {</div><div class="line">                            reply = $<span class="stringliteral">&quot;You quit on {e.Last}--maybe you can finish next time!&quot;</span>;</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                        {</div><div class="line">                            reply = <span class="stringliteral">&quot;Sorry, I&#39;ve had a short circuit.  Please try again.&quot;</span>;</div><div class="line">                        }</div><div class="line">                        await context.PostAsync(reply);</div><div class="line">                    }</div><div class="line">                });</div><div class="line">        }</div></div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="finalBot"></a>
Final Sandwich Bot</h2>
<p>Here is the final SandwichOrder with attributes, business logic and a more complex form. </p><div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="d1/d6a/namespace_microsoft_1_1_bot_1_1_builder_1_1_dialogs.html">Dialogs</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html">FormFlow</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html">FormFlow</a>.<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html">Advanced</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.<a class="code" href="d3/ddb/namespace_microsoft_1_1_bot_1_1_builder.html">Builder</a>.<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html">FormFlow</a>.<a class="code" href="d8/d26/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_json.html">Json</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.<a class="code" href="d5/d61/namespace_microsoft_1_1_bot.html">Bot</a>.Sample.AnnotatedSandwichBot.Resource;</div><div class="line"><span class="keyword">using</span> Newtonsoft.Json.Linq;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Collections.Concurrent;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Collections.Generic;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Globalization;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.IO;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Linq;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Reflection;</div><div class="line"><span class="keyword">using</span> <a class="code" href="d8/dd0/namespace_system.html">System</a>.Threading;</div><div class="line"><span class="preprocessor">#pragma warning disable 649</span></div><div class="line"></div><div class="line"><span class="comment">// The SandwichOrder is the simple form you want to fill out.  It must be serializable so the bot can be stateless.</span></div><div class="line"><span class="comment">// The order of fields defines the default order in which questions will be asked.</span></div><div class="line"><span class="comment">// Enumerations shows the legal options for each field in the SandwichOrder and the order is the order values will be presented </span></div><div class="line"><span class="comment">// in a conversation.</span></div><div class="line"><span class="keyword">namespace </span><a class="code" href="d7/d4e/namespace_microsoft.html">Microsoft</a>.Bot.Sample.AnnotatedSandwichBot</div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SandwichOptions</div><div class="line">    {</div><div class="line">        BLT, BlackForestHam, BuffaloChicken, ChickenAndBaconRanchMelt, ColdCutCombo, MeatballMarinara,</div><div class="line">        OvenRoastedChicken, RoastBeef,</div><div class="line">        [Terms(<span class="stringliteral">@&quot;rotis\w* style chicken&quot;</span>, MaxPhrase = 3)]</div><div class="line">        RotisserieStyleChicken, SpicyItalian, SteakAndCheese, SweetOnionTeriyaki, Tuna,</div><div class="line">        TurkeyBreast, Veggie</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> LengthOptions { SixInch, FootLong };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> BreadOptions</div><div class="line">    {</div><div class="line">        <span class="comment">// Use an image if generating cards</span></div><div class="line">        <span class="comment">// [Describe(Image = @&quot;https://placeholdit.imgix.net/~text?txtsize=12&amp;txt=Special&amp;w=100&amp;h=40&amp;txttrack=0&amp;txtclr=000&amp;txtfont=bold&quot;)]</span></div><div class="line">        NineGrainWheat,</div><div class="line">        NineGrainHoneyOat,</div><div class="line">        Italian,</div><div class="line">        ItalianHerbsAndCheese,</div><div class="line">        Flatbread</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> CheeseOptions { American, MontereyCheddar, Pepperjack };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> ToppingOptions</div><div class="line">    {</div><div class="line">        <span class="comment">// This starts at 1 because 0 is the &quot;no value&quot; value</span></div><div class="line">        [Terms(<span class="stringliteral">&quot;except&quot;</span>, <span class="stringliteral">&quot;but&quot;</span>, <span class="stringliteral">&quot;not&quot;</span>, <span class="stringliteral">&quot;no&quot;</span>, <span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;everything&quot;</span>)]</div><div class="line">        Everything = 1,</div><div class="line">        Avocado, BananaPeppers, Cucumbers, GreenBellPeppers, Jalapenos,</div><div class="line">        Lettuce, Olives, Pickles, RedOnion, Spinach, Tomatoes</div><div class="line">    };</div><div class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> SauceOptions</div><div class="line">    {</div><div class="line">        ChipotleSouthwest, HoneyMustard, LightMayonnaise, RegularMayonnaise,</div><div class="line">        Mustard, Oil, Pepper, Ranch, SweetOnion, Vinegar</div><div class="line">    };</div><div class="line"></div><div class="line">    [Serializable]</div><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.NotUnderstood, <span class="stringliteral">&quot;I do not understand \&quot;{0}\&quot;.&quot;</span>, <span class="stringliteral">&quot;Try again, I don&#39;t get \&quot;{0}\&quot;.&quot;</span>)]</div><div class="line">    [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.EnumSelectOne, <span class="stringliteral">&quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;</span>)]</div><div class="line">    <span class="comment">// [Template(TemplateUsage.EnumSelectOne, &quot;What kind of {&amp;} would you like on your sandwich? {||}&quot;, ChoiceStyle = ChoiceStyleOptions.PerLine)]</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>SandwichOrder</div><div class="line">    {</div><div class="line">        [Prompt(<span class="stringliteral">&quot;What kind of {&amp;} would you like? {||}&quot;</span>)]</div><div class="line">        [Describe(Image = <span class="stringliteral">@&quot;https://placeholdit.imgix.net/~text?txtsize=16&amp;txt=Sandwich&amp;w=125&amp;h=40&amp;txttrack=0&amp;txtclr=000&amp;txtfont=bold&quot;</span>)]</div><div class="line">        <span class="comment">// [Prompt(&quot;What kind of {&amp;} would you like? {||}&quot;, ChoiceFormat =&quot;{1}&quot;)]</span></div><div class="line">        <span class="comment">// [Prompt(&quot;What kind of {&amp;} would you like?&quot;)]</span></div><div class="line">        <span class="keyword">public</span> SandwichOptions? Sandwich;</div><div class="line"></div><div class="line">        [Prompt(<span class="stringliteral">&quot;What size of sandwich do you want? {||}&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> LengthOptions? Length;</div><div class="line"></div><div class="line">        <span class="comment">// Specify Title and SubTitle if generating cards</span></div><div class="line">        [Describe(Title = <span class="stringliteral">&quot;Sandwich Bot&quot;</span>, SubTitle = <span class="stringliteral">&quot;Bread Picker&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> BreadOptions? Bread;</div><div class="line"></div><div class="line">        <span class="comment">// An optional annotation means that it is possible to not make a choice in the field.</span></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> CheeseOptions? Cheese;</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> List&lt;ToppingOptions&gt; Toppings { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        <span class="keyword">public</span> List&lt;SauceOptions&gt; Sauces;</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.NoPreference, <span class="stringliteral">&quot;None&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> Specials;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> DeliveryAddress;</div><div class="line"></div><div class="line">        [Pattern(<span class="stringliteral">@&quot;(\(\d{3}\))?\s*\d{3}(-|\s*)\d{4}&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">string</span> PhoneNumber;</div><div class="line"></div><div class="line">        [Optional]</div><div class="line">        [Template(<a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313">TemplateUsage</a>.StatusFormat, <span class="stringliteral">&quot;{&amp;}: {:t}&quot;</span>, FieldCase = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a4b3fef3ebd0b6d6f84591f4430ae2fd5">CaseNormalization</a>.None)]</div><div class="line">        <span class="keyword">public</span> <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a28ef6a551a3611e4a6abe06659797313a8cf10d2341ed01492506085688270c1e">DateTime</a>? DeliveryTime;</div><div class="line"></div><div class="line">        [Numeric(1, 5)]</div><div class="line">        [Optional]</div><div class="line">        [Describe(<span class="stringliteral">&quot;your experience today&quot;</span>)]</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">double</span>? Rating;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildForm()</div><div class="line">        {</div><div class="line">            OnCompletionAsyncDelegate&lt;SandwichOrder&gt; processOrder = async (context, state) =&gt;</div><div class="line">            {</div><div class="line">                await context.PostAsync(<span class="stringliteral">&quot;We are currently processing your sandwich. We will message you the status.&quot;</span>);</div><div class="line">            };</div><div class="line"></div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                        .Field(nameof(Sandwich))</div><div class="line">                        .Field(nameof(Length))</div><div class="line">                        .Field(nameof(Bread))</div><div class="line">                        .Field(nameof(Cheese))</div><div class="line">                        .Field(nameof(Toppings),</div><div class="line">                            validate: async (state, value) =&gt;</div><div class="line">                            {</div><div class="line">                                var values = ((List&lt;object&gt;)value).OfType&lt;ToppingOptions&gt;();</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = values };</div><div class="line">                                <span class="keywordflow">if</span> (values != null &amp;&amp; values.Contains(ToppingOptions.Everything))</div><div class="line">                                {</div><div class="line">                                    result.Value = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                                    where topping != ToppingOptions.Everything &amp;&amp; !values.Contains(topping)</div><div class="line">                                                    select topping).ToList();</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sauces))</div><div class="line">                        .Field(<span class="keyword">new</span> FieldReflector&lt;SandwichOrder&gt;(nameof(Specials))</div><div class="line">                            .SetType(null)</div><div class="line">                            .SetActive((state) =&gt; state.Length == LengthOptions.FootLong)</div><div class="line">                            .SetDefine(async (state, field) =&gt;</div><div class="line">                            {</div><div class="line">                                field</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;Free cookie&quot;</span>)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;cookie&quot;</span>, <span class="stringliteral">&quot;free cookie&quot;</span>)</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;Free large drink&quot;</span>)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;drink&quot;</span>, <span class="stringliteral">&quot;free drink&quot;</span>);</div><div class="line">                                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">                            }))</div><div class="line">                        .Confirm(async (state) =&gt;</div><div class="line">                        {</div><div class="line">                            var cost = 0.0;</div><div class="line">                            <span class="keywordflow">switch</span> (state.Length)</div><div class="line">                            {</div><div class="line">                                case LengthOptions.SixInch: cost = 5.0; break;</div><div class="line">                                case LengthOptions.FootLong: cost = 6.50; break;</div><div class="line">                            }</div><div class="line">                            <span class="keywordflow">return</span> <span class="keyword">new</span> PromptAttribute($<span class="stringliteral">&quot;Total for your sandwich is {cost:C2} is that ok?&quot;</span>);</div><div class="line">                        })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryAddress),</div><div class="line">                            validate: async (state, response) =&gt;</div><div class="line">                            {</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = response };</div><div class="line">                                var address = (response as string).Trim();</div><div class="line">                                <span class="keywordflow">if</span> (address.Length &gt; 0 &amp;&amp; (address[0] &lt; <span class="charliteral">&#39;0&#39;</span> || address[0] &gt; <span class="charliteral">&#39;9&#39;</span>))</div><div class="line">                                {</div><div class="line">                                    result.Feedback = <span class="stringliteral">&quot;Address must start with a number.&quot;</span>;</div><div class="line">                                    result.IsValid = <span class="keyword">false</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryTime), <span class="stringliteral">&quot;What time do you want your sandwich delivered? {||}&quot;</span>)</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a70d9be9b139893aa6c69b5e77e614311">Confirm</a>(<span class="stringliteral">&quot;Do you want to order your {Length} {Sandwich} on {Bread} {&amp;Bread} with {[{Cheese} {Toppings} {Sauces}]} to be sent to {DeliveryAddress} {?at {DeliveryTime:t}}?&quot;</span>)</div><div class="line">                        .AddRemainingFields()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Thanks for ordering a sandwich!&quot;</span>)</div><div class="line">                        .OnCompletion(processOrder)</div><div class="line">                        .Build();</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;JObject&gt; BuildJsonForm()</div><div class="line">        {</div><div class="line">            <span class="keyword">using</span> (var stream = Assembly.GetExecutingAssembly().GetManifestResourceStream(<span class="stringliteral">&quot;Microsoft.Bot.Sample.AnnotatedSandwichBot.AnnotatedSandwich.json&quot;</span>))</div><div class="line">            {</div><div class="line">                var schema = JObject.Parse(<span class="keyword">new</span> StreamReader(stream).ReadToEnd());</div><div class="line">                <span class="keywordflow">return</span> <span class="keyword">new</span> FormBuilderJson(schema)</div><div class="line">                    .AddRemainingFields()</div><div class="line">                    .Build();</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;JObject&gt; BuildJsonFormExplicit()</div><div class="line">        {</div><div class="line">            <span class="keyword">using</span> (var stream = Assembly.GetExecutingAssembly().GetManifestResourceStream(<span class="stringliteral">&quot;Microsoft.Bot.Sample.AnnotatedSandwichBot.AnnotatedSandwich.json&quot;</span>))</div><div class="line">            {</div><div class="line">                var schema = JObject.Parse(<span class="keyword">new</span> StreamReader(stream).ReadToEnd());</div><div class="line">                OnCompletionAsyncDelegate&lt;JObject&gt; processOrder = async (context, state) =&gt;</div><div class="line">                {</div><div class="line">                    await context.PostAsync(DynamicSandwich.Processing);</div><div class="line">                };</div><div class="line">                var builder = <span class="keyword">new</span> FormBuilderJson(schema);</div><div class="line">                <span class="keywordflow">return</span> builder</div><div class="line">                            .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                            .Field(<span class="stringliteral">&quot;Sandwich&quot;</span>)</div><div class="line">                            .Field(<span class="stringliteral">&quot;Length&quot;</span>)</div><div class="line">                            .Field(<span class="stringliteral">&quot;Ingredients.Bread&quot;</span>)</div><div class="line">                            .Field(<span class="stringliteral">&quot;Ingredients.Cheese&quot;</span>)</div><div class="line">                            .Field(<span class="stringliteral">&quot;Ingredients.Toppings&quot;</span>,</div><div class="line">                            validate: async (state, response) =&gt;</div><div class="line">                            {</div><div class="line">                                var value = (IList&lt;object&gt;)response;</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult() { IsValid = <span class="keyword">true</span> };</div><div class="line">                                <span class="keywordflow">if</span> (value != null &amp;&amp; value.Contains(<span class="stringliteral">&quot;Everything&quot;</span>))</div><div class="line">                                {</div><div class="line">                                    result.Value = (from topping in <span class="keyword">new</span> <span class="keywordtype">string</span>[] {</div><div class="line">                                    <span class="stringliteral">&quot;Avocado&quot;</span>, <span class="stringliteral">&quot;BananaPeppers&quot;</span>, <span class="stringliteral">&quot;Cucumbers&quot;</span>, <span class="stringliteral">&quot;GreenBellPeppers&quot;</span>,</div><div class="line">                                    <span class="stringliteral">&quot;Jalapenos&quot;</span>, <span class="stringliteral">&quot;Lettuce&quot;</span>, <span class="stringliteral">&quot;Olives&quot;</span>, <span class="stringliteral">&quot;Pickles&quot;</span>,</div><div class="line">                                    <span class="stringliteral">&quot;RedOnion&quot;</span>, <span class="stringliteral">&quot;Spinach&quot;</span>, <span class="stringliteral">&quot;Tomatoes&quot;</span>}</div><div class="line">                                                    where !value.Contains(topping)</div><div class="line">                                                    select topping).ToList();</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">else</span></div><div class="line">                                {</div><div class="line">                                    result.Value = value;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            }</div><div class="line">                            )</div><div class="line">                            .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Ingredients.Toppings}.&quot;</span>)</div><div class="line">                            .Field(<span class="stringliteral">&quot;Ingredients.Sauces&quot;</span>)</div><div class="line">                            .Field(<span class="keyword">new</span> FieldJson(builder, <span class="stringliteral">&quot;Specials&quot;</span>)</div><div class="line">                                .SetType(null)</div><div class="line">                                .SetActive((state) =&gt; (<span class="keywordtype">string</span>)state[<span class="stringliteral">&quot;Length&quot;</span>] == <span class="stringliteral">&quot;FootLong&quot;</span>)</div><div class="line">                                .SetDefine(async (state, field) =&gt;</div><div class="line">                                {</div><div class="line">                                    field</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;cookie&quot;</span>, DynamicSandwich.FreeCookie)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;cookie&quot;</span>, Language.GenerateTerms(DynamicSandwich.FreeCookie, 2))</div><div class="line">                                    .AddDescription(<span class="stringliteral">&quot;drink&quot;</span>, DynamicSandwich.FreeDrink)</div><div class="line">                                    .AddTerms(<span class="stringliteral">&quot;drink&quot;</span>, Language.GenerateTerms(DynamicSandwich.FreeDrink, 2));</div><div class="line">                                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">                                }))</div><div class="line">                            .Confirm(async (state) =&gt;</div><div class="line">                            {</div><div class="line">                                var cost = 0.0;</div><div class="line">                                <span class="keywordflow">switch</span> ((<span class="keywordtype">string</span>)state[<span class="stringliteral">&quot;Length&quot;</span>])</div><div class="line">                                {</div><div class="line">                                    <span class="keywordflow">case</span> <span class="stringliteral">&quot;SixInch&quot;</span>: cost = 5.0; <span class="keywordflow">break</span>;</div><div class="line">                                    <span class="keywordflow">case</span> <span class="stringliteral">&quot;FootLong&quot;</span>: cost = 6.50; <span class="keywordflow">break</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> <span class="keyword">new</span> PromptAttribute(<span class="keywordtype">string</span>.Format(DynamicSandwich.Cost, cost));</div><div class="line">                            })</div><div class="line">                            .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(<span class="stringliteral">&quot;DeliveryAddress&quot;</span>,</div><div class="line">                                validate: async (state, value) =&gt;</div><div class="line">                                {</div><div class="line">                                    var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = value };</div><div class="line">                                    var address = (value as string).Trim();</div><div class="line">                                    <span class="keywordflow">if</span> (address.Length &gt; 0 &amp;&amp; (address[0] &lt; <span class="charliteral">&#39;0&#39;</span> || address[0] &gt; <span class="charliteral">&#39;9&#39;</span>))</div><div class="line">                                    {</div><div class="line">                                        result.Feedback = DynamicSandwich.BadAddress;</div><div class="line">                                        result.IsValid = <span class="keyword">false</span>;</div><div class="line">                                    }</div><div class="line">                                    <span class="keywordflow">return</span> result;</div><div class="line">                                })</div><div class="line">                            .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(<span class="stringliteral">&quot;DeliveryTime&quot;</span>, <span class="stringliteral">&quot;What time do you want your sandwich delivered? {||}&quot;</span>)</div><div class="line">                            .Confirm(<span class="stringliteral">&quot;Do you want to order your {Length} {Sandwich} on {Ingredients.Bread} {&amp;Ingredients.Bread} with {[{Ingredients.Cheese} {Ingredients.Toppings} {Ingredients.Sauces}]} to be sent to {DeliveryAddress} {?at {DeliveryTime:t}}?&quot;</span>)</div><div class="line">                            .AddRemainingFields()</div><div class="line">                            .Message(<span class="stringliteral">&quot;Thanks for ordering a sandwich!&quot;</span>)</div><div class="line">                            .OnCompletion(processOrder)</div><div class="line">                    .Build();</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Cache of culture specific forms. </span></div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> ConcurrentDictionary&lt;CultureInfo, IForm&lt;SandwichOrder&gt;&gt; _forms = <span class="keyword">new</span> ConcurrentDictionary&lt;CultureInfo, IForm&lt;SandwichOrder&gt;&gt;();</div><div class="line"></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> IForm&lt;SandwichOrder&gt; BuildLocalizedForm()</div><div class="line">        {</div><div class="line">            var culture = Thread.CurrentThread.CurrentUICulture;</div><div class="line">            IForm&lt;SandwichOrder&gt; form;</div><div class="line">            <span class="keywordflow">if</span> (!_forms.TryGetValue(culture, out form))</div><div class="line">            {</div><div class="line">                OnCompletionAsyncDelegate&lt;SandwichOrder&gt; processOrder = async (context, state) =&gt;</div><div class="line">                                {</div><div class="line">                                    await context.PostAsync(DynamicSandwich.Processing);</div><div class="line">                                };</div><div class="line">                <span class="comment">// Form builder uses the thread culture to automatically switch framework strings</span></div><div class="line">                <span class="comment">// and also your static strings as well.  Dynamically defined fields must do their own localization.</span></div><div class="line">                var builder = <span class="keyword">new</span> FormBuilder&lt;SandwichOrder&gt;()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Welcome to the sandwich order bot!&quot;</span>)</div><div class="line">                        .Field(nameof(Sandwich))</div><div class="line">                        .Field(nameof(Length))</div><div class="line">                        .Field(nameof(Bread))</div><div class="line">                        .Field(nameof(Cheese))</div><div class="line">                        .Field(nameof(Toppings),</div><div class="line">                            validate: async (state, value) =&gt;</div><div class="line">                            {</div><div class="line">                                var values = ((List&lt;object&gt;)value).OfType&lt;ToppingOptions&gt;();</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = values };</div><div class="line">                                <span class="keywordflow">if</span> (values != null &amp;&amp; values.Contains(ToppingOptions.Everything))</div><div class="line">                                {</div><div class="line">                                    result.Value = (from ToppingOptions topping in Enum.GetValues(typeof(ToppingOptions))</div><div class="line">                                                    where topping != ToppingOptions.Everything &amp;&amp; !values.Contains(topping)</div><div class="line">                                                    select topping).ToList();</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .Message(<span class="stringliteral">&quot;For sandwich toppings you have selected {Toppings}.&quot;</span>)</div><div class="line">                        .Field(nameof(SandwichOrder.Sauces))</div><div class="line">                        .Field(<span class="keyword">new</span> FieldReflector&lt;SandwichOrder&gt;(nameof(Specials))</div><div class="line">                            .SetType(null)</div><div class="line">                            .SetActive((state) =&gt; state.Length == LengthOptions.FootLong)</div><div class="line">                            .SetDefine(async (state, field) =&gt;</div><div class="line">                                {</div><div class="line">                                    field</div><div class="line">                                        .AddDescription(<span class="stringliteral">&quot;cookie&quot;</span>, DynamicSandwich.FreeCookie)</div><div class="line">                                        .AddTerms(<span class="stringliteral">&quot;cookie&quot;</span>, Language.GenerateTerms(DynamicSandwich.FreeCookie, 2))</div><div class="line">                                        .AddDescription(<span class="stringliteral">&quot;drink&quot;</span>, DynamicSandwich.FreeDrink)</div><div class="line">                                        .AddTerms(<span class="stringliteral">&quot;drink&quot;</span>, Language.GenerateTerms(DynamicSandwich.FreeDrink, 2));</div><div class="line">                                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">                                }))</div><div class="line">                        .Confirm(async (state) =&gt;</div><div class="line">                            {</div><div class="line">                                var cost = 0.0;</div><div class="line">                                <span class="keywordflow">switch</span> (state.Length)</div><div class="line">                                {</div><div class="line">                                    case LengthOptions.SixInch: cost = 5.0; break;</div><div class="line">                                    case LengthOptions.FootLong: cost = 6.50; break;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> <span class="keyword">new</span> PromptAttribute(<span class="keywordtype">string</span>.Format(DynamicSandwich.Cost, cost) + <span class="stringliteral">&quot;{||}&quot;</span>);</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryAddress),</div><div class="line">                            validate: async (state, response) =&gt;</div><div class="line">                            {</div><div class="line">                                var result = <span class="keyword">new</span> ValidateResult { IsValid = <span class="keyword">true</span>, <a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a689202409e48743b914713f96d93947c">Value</a> = response };</div><div class="line">                                var address = (response as string).Trim();</div><div class="line">                                <span class="keywordflow">if</span> (address.Length &gt; 0 &amp;&amp; address[0] &lt; <span class="charliteral">&#39;0&#39;</span> || address[0] &gt; <span class="charliteral">&#39;9&#39;</span>)</div><div class="line">                                {</div><div class="line">                                    result.Feedback = DynamicSandwich.BadAddress;</div><div class="line">                                    result.IsValid = <span class="keyword">false</span>;</div><div class="line">                                }</div><div class="line">                                <span class="keywordflow">return</span> result;</div><div class="line">                            })</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#af6f89ca03465cbc9364907e5cad3a0c0a6f16a5f8ff5d75ab84c018adacdfcbb7">Field</a>(nameof(SandwichOrder.DeliveryTime), <span class="stringliteral">&quot;What time do you want your sandwich delivered? {||}&quot;</span>)</div><div class="line">                        .<a class="code" href="de/d58/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced.html#a95eb4c1ce6f0a9eb18da155b77311c91a70d9be9b139893aa6c69b5e77e614311">Confirm</a>(<span class="stringliteral">&quot;Do you want to order your {Length} {Sandwich} on {Bread} {&amp;Bread} with {[{Cheese} {Toppings} {Sauces}]} to be sent to {DeliveryAddress} {?at {DeliveryTime:t}}?&quot;</span>)</div><div class="line">                        .AddRemainingFields()</div><div class="line">                        .Message(<span class="stringliteral">&quot;Thanks for ordering a sandwich!&quot;</span>)</div><div class="line">                        .OnCompletion(processOrder);</div><div class="line">                builder.Configuration.DefaultPrompt.ChoiceStyle = <a class="code" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#ac6396117e96818e92b4892d316e326d9">ChoiceStyleOptions</a>.Auto;</div><div class="line">                form = builder.Build();</div><div class="line">                _forms[culture] = form;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">return</span> form;</div><div class="line">        }</div><div class="line">    };</div><div class="line">}</div></div><!-- fragment --><p>With all of these improvements, here is what the interaction looks like now. </p><div class="fragment"><div class="line">Welcome to the sandwich order bot!</div><div class="line"></div><div class="line">What kind of sandwich would you like?</div><div class="line"> 1. BLT</div><div class="line"> 2. Black Forest Ham</div><div class="line"> 3. Buffalo Chicken</div><div class="line"> 4. Chicken And Bacon Ranch Melt</div><div class="line"> 5. Cold Cut Combo</div><div class="line"> 6. Meatball Marinara</div><div class="line"> 7. Oven Roasted Chicken</div><div class="line"> 8. Roast Beef</div><div class="line"> 9. Rotisserie Style Chicken</div><div class="line"> 10. Spicy Italian</div><div class="line"> 11. Steak And Cheese</div><div class="line"> 12. Sweet Onion Teriyaki</div><div class="line"> 13. Tuna</div><div class="line"> 14. Turkey Breast</div><div class="line"> 15. Veggie</div><div class="line">&gt; 2</div><div class="line">What size of sandwich <span class="keywordflow">do</span> you want? (1. Six Inch, 2. Foot Long)</div><div class="line">&gt; 2</div><div class="line">What kind of bread would you like on your sandwich?</div><div class="line"> 1. Nine Grain Wheat</div><div class="line"> 2. Nine Grain Honey Oat</div><div class="line"> 3. Italian</div><div class="line"> 4. Italian Herbs And Cheese</div><div class="line"> 5. Flatbread</div><div class="line">&gt; nine grain</div><div class="line">By <span class="stringliteral">&quot;nine grain&quot;</span> bread did you mean (1. Nine Grain Honey Oat, 2. Nine Grain Wheat)</div><div class="line">&gt; 1</div><div class="line">What kind of cheese would you like on your sandwich? (current choice: No Preference)</div><div class="line"> 1. American</div><div class="line"> 2. Monterey Cheddar</div><div class="line"> 3. Pepperjack</div><div class="line">&gt; 3</div><div class="line">Please select one or more toppings(current choice: No Preference)</div><div class="line"> 1. Everything</div><div class="line"> 2. Avocado</div><div class="line"> 3. Banana Peppers</div><div class="line"> 4. Cucumbers</div><div class="line"> 5. Green Bell Peppers</div><div class="line"> 6. Jalapenos</div><div class="line"> 7. Lettuce</div><div class="line"> 8. Olives</div><div class="line"> 9. Pickles</div><div class="line"> 10. Red Onion</div><div class="line"> 11. Spinach</div><div class="line"> 12. Tomatoes</div><div class="line">&gt; everything but jalapenos</div><div class="line">For sandwich toppings you have selected Avocado, Banana Peppers, Cucumbers, Green Bell Peppers, Lettuce, Olives, Pickles, Red Onion, Spinach, and Tomatoes.</div><div class="line"></div><div class="line">Please select one or more sauces (current choice: No Preference)</div><div class="line"> 1. Honey Mustard</div><div class="line"> 2. Light Mayonnaise</div><div class="line"> 3. Regular Mayonnaise</div><div class="line"> 4. Mustard</div><div class="line"> 5. Oil</div><div class="line"> 6. Pepper</div><div class="line"> 7. Ranch</div><div class="line"> 8. Sweet Onion</div><div class="line"> 9. Vinegar</div><div class="line">&gt;</div><div class="line">What kind of specials would you like on your sandwich? (current choice: <a class="code" href="d1/d6a/namespace_microsoft_1_1_bot_1_1_builder_1_1_dialogs.html#a8e0b95fd4acd5831ff99c381d8c65beaa6adf97f83acf6453d4a6a4b1070f3754">None</a>)</div><div class="line"> 1. Free cookie</div><div class="line"> 2. Free large drink</div><div class="line">&gt; 1</div><div class="line">Total <span class="keywordflow">for</span> your sandwich is $6.50 is that ok?</div><div class="line">&gt;  y</div><div class="line">Please enter delivery address</div><div class="line">&gt; 123 State Street</div><div class="line">What time <span class="keywordflow">do</span> you want your sandwich delivered? (current choice: No Preference)</div><div class="line">&gt; 4:30pm</div><div class="line">Do you want to order your Foot Long Black Forest Ham on Nine Grain Honey Oat bread with Pepperjack, Avocado, Banana Peppers, Cucumbers, Green Bell Peppers, Lettuce, Olives, Pickles, Red Onion, Spinach, and Tomatoes to be sent to 123 State Street at 4:30 PM?</div><div class="line">&gt; y</div><div class="line">Please enter a number between 1.0 and 5.0 <span class="keywordflow">for</span> your experience today(current choice: No Preference)</div><div class="line">&gt; 5</div><div class="line">Thanks <span class="keywordflow">for</span> ordering a sandwich!</div><div class="line">Processed your order!</div></div><!-- fragment --><h1><a class="anchor" id="initialState"></a>
Passing in Initial Form State and Entities</h1>
<p>When you launch a <a class="el" href="db/de5/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_dialog.html" title="Form dialog to fill in your state. ">FormDialog</a>, you can optionally pass in an instance of your state. If you do that, any step for filling a field is skipped if that field has a value unless you pass in <a class="el" href="dd/df7/namespace_microsoft_1_1_bot_1_1_builder_1_1_form_flow.html#a27be39918296ad3536d6a5c8d6ed5394aa796e574d8cf50f288b2e44ecd64764a" title="Prompt for fields that already have a value in the initial state when processing form. ">FormOptions.PromptFieldsWithValues</a> which will prompt for fields, but use the passed in state for defaults.</p>
<p>You can also pass in <a href="http://luis.ai">LUIS</a> entities to bind to the state. If the EntityRecommendation.Type is a path to a field in your C# class then the EntityRecommendation.Entity will be passed through the recognizer to bind to your field. Just like initial state, any step for filling in that field will be skipped.</p>
<h1><a class="anchor" id="patterns"></a>
Pattern Language</h1>
<p>One of the keys to creating a bot is being able to generate text that is clear and meaningful to the bot user. This framework supports a pattern language with elements that can be filled in at runtime. Everything in a pattern that is not surrounded by curly braces is just passed straight through. Anything in curly braces is substitued with values to make a string that can be shown to the user. Once substitution is done, some additional processing to remove double spaces and use the proper form of a/an is also done.</p>
<p>Possible curly brace pattern elements are outlined in the table below. Within a pattern element, "&lt;field&gt;" refers to the path within your form class to get to the field value. So if I had a class with a field named "Size" you would refer to the size value with the pattern element {Size}. "..." within a pattern element means multiple elements are allowed. "&lt;format&gt;" within a pattern element means that you can optionally specify a regular C# format specifier, i.e. if "Rating" were a double field I could show it with two digits of precision by using the pattern element "{Rating:F2}". "&lt;n&gt;" shows where you can specify a reference to the nth argument of a template. (See TemplateUsage to see what arguments each template can use.)</p>
<table class="doxtable">
<tr>
<th>Pattern Element </th><th>Description  </th></tr>
<tr>
<td>{&lt;format&gt;} </td><td>Value of the current field. </td></tr>
<tr>
<td>{&amp;} </td><td>Description of the current field. </td></tr>
<tr>
<td>{&lt;field&gt;&lt;format&gt;} </td><td>Value of a particular field. </td></tr>
<tr>
<td>{&amp;&lt;field&gt;} </td><td>Description of a particular field. </td></tr>
<tr>
<td>{||} </td><td>Show the current choices which can be the current value, no preference or the possible values for enumerated fields. </td></tr>
<tr>
<td>{[{&lt;field&gt;&lt;format&gt;} ...]} </td><td>Create a list with all field values together utilizing <a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#aa55384cb431ff75190efe7abd2fdb6a7">Separator</a> and <a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a72a59330fcdc04cf70b922c6d217d44c">LastSeparator</a> to separate the individual values. </td></tr>
<tr>
<td>{*} </td><td>Show one line for each active field with the description and current value. </td></tr>
<tr>
<td>{*filled} </td><td>Show one line for each active field that has an actual value with the description and current value. </td></tr>
<tr>
<td>{&lt;nth&gt;&lt;format&gt;} </td><td>A regular C# format specifier that refers to the nth arg. See TemplateUsage to see what args are available. </td></tr>
<tr>
<td>{?&lt;textOrPatternElement&gt;...} </td><td>Conditional substitution. If all referred to pattern elements have values, the values are substituted and the whole expression is used. </td></tr>
</table>
<p>Patterns are used in <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> and <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> attributes. <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> defines a prompt to the user for a particular field or confirmation. <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> is used to automatically construct prompts and other things like help. There is a built-in set of templates defined in <a class="el" href="de/db8/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_form_configuration.html#a40fe1b7c1bb62d7ae2accb8501a597a5" title="Default templates to use if not override on the class or field level. ">FormConfiguration.Templates</a>. A good way to see examples of the pattern language is to look at the templates defined there. A <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> can be specified by using it as an attribute on a particular field or property or implicitly defined through <a class="el" href="d4/d1c/interface_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_i_form_builder.html#ad7881ee9b6a31bcd4acf2033eca8d097" title="Derfine a field step by supplying your own field definition. ">IFormBuilder&lt;T&gt;.Field</a>. A default <a class="el" href="d7/d0a/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_template_attribute.html">Template</a> can be overridden on a class or field basis. Both prompts and templates support the formatting parameters outlined below.</p>
<table class="doxtable">
<tr>
<th>Usage </th><th>Description  </th></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a07d2759e7867bc1e885bfd7d856a27a2">AllowDefault</a> </td><td>When processing choices using {||} controls whether the current value should be showed as a choice. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a522b13b829c06497ddb2f8d960065ff8">ChoiceCase</a> </td><td>When processing choices for {||} controls case normalization for each choice. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a6c9b5b59599cd48b048831a558d61aa1">ChoiceFormat</a> </td><td>When processing choices for {||} controls how each choice is formatted. {0} is the choice number and {1} the choice description. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a3410d30374f584de65628431a8c8e9e8">ChoiceLastSeparator</a> </td><td>When inline choice lists are constructed for {||} provides the separator before the last choice. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a12c004b89c5c0aa315a7a2d1a39204d9">ChoiceParens</a> </td><td>When inline choice lists are constructed for {||} indicates whether or not they are in parentheses. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a0791502822c338ac00b85e6de46e4d6f">ChoiceSeparator</a> </td><td>When inline choice lists are constructed for {||} provides the separator before every choice except the last. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a897a99309a7705ccb35a723904593745">ChoiceStyle</a> </td><td>When processing choices using {||} controls whether the choices are presented in line or per line. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#af025c76078551917a3ee3f0d67ce4cfc">Feedback</a> </td><td>For <a class="el" href="d0/d34/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_prompt_attribute.html">Prompt</a> only controls feedback after user entry. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a2325d2ddd4dd311a57af57d2039c1950">FieldCase</a> </td><td>Controls case normalization when displaying a field description. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a72a59330fcdc04cf70b922c6d217d44c">LastSeparator</a> </td><td>When lists are constructed for {[]} provides the separator before the last item. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#aa55384cb431ff75190efe7abd2fdb6a7">Separator</a> </td><td>When lists are constructed for {[]} provides the separator before every item except the last. </td></tr>
<tr>
<td><a class="el" href="d7/d48/class_microsoft_1_1_bot_1_1_builder_1_1_form_flow_1_1_advanced_1_1_template_base_attribute.html#a3de7c77ed975e3cf5ba13679e5d3e2f5">ValueCase</a> </td><td>Controls case normalization when displaying a field value. </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<!-- id is needed for treeview function! -->
<div class="outline footer">
    <ul>
        <li><a href="//aka.ms/bf-contactus">Contact us</a></li>
        <li><a href="//aka.ms/bf-privacy">Privacy & cookies</a></li>
        <li><a href="//aka.ms/bf-terms">Terms of use</a></li>
        <li><a href="//aka.ms/bf-conduct">Code of conduct</a></li>
        <li>&copy; 2016 Microsoft</li>
    </ul>
</div>
<script src="//bot-framework.azureedge.net/libs/svgxuse.js"></script>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100954936); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100954936ns.gif" /></p></noscript>
</body>
</html>
